<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="es" xml:lang="es"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.551">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Análisis de datos - 6&nbsp; Series temporales</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./referencias.html" rel="next">
<link href="./t5_clustering.html" rel="prev">
<link href="./Figuras/atlas.jpeg" rel="icon" type="image/jpeg">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "Sin resultados",
    "search-matching-documents-text": "documentos encontrados",
    "search-copy-link-title": "Copiar el enlace en la búsqueda",
    "search-hide-matches-text": "Ocultar resultados adicionales",
    "search-more-match-text": "resultado adicional en este documento",
    "search-more-matches-text": "resultados adicionales en este documento",
    "search-clear-button-title": "Borrar",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancelar",
    "search-submit-button-title": "Enviar",
    "search-label": "Buscar"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Alternar barra lateral" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./t6_series_temporales.html"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Series temporales</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Alternar barra lateral" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Análisis de datos</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/AprendeR-UIB/AD" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Alternar modo lector">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Buscar"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Presentación</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./t1_intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introducción al Análisis de Datos</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./t2_em.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Análisis Multivariante</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./t3_inferencia.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Inferencia multivariante en poblaciones normales</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./t4_trd.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Técnicas de reducción de Dimensionalidad</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./t5_clustering.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Agrupamiento (Clustering)</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./t6_series_temporales.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Series temporales</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./referencias.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Referencias</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Tabla de contenidos</h2>
   
  <ul>
  <li><a href="#introducción" id="toc-introducción" class="nav-link active" data-scroll-target="#introducción"><span class="header-section-number">6.1</span> Introducción</a>
  <ul class="collapse">
  <li><a href="#qué-es-una-serie-temporal" id="toc-qué-es-una-serie-temporal" class="nav-link" data-scroll-target="#qué-es-una-serie-temporal"><span class="header-section-number">6.1.1</span> ¿Qué es una serie temporal?</a></li>
  <li><a href="#cómo-crear-una-serie-de-tiempo-en-r" id="toc-cómo-crear-una-serie-de-tiempo-en-r" class="nav-link" data-scroll-target="#cómo-crear-una-serie-de-tiempo-en-r"><span class="header-section-number">6.1.2</span> ¿Cómo crear una serie de tiempo en R?</a></li>
  </ul></li>
  <li><a href="#series-temporales-y-procesos-estocásticos" id="toc-series-temporales-y-procesos-estocásticos" class="nav-link" data-scroll-target="#series-temporales-y-procesos-estocásticos"><span class="header-section-number">6.2</span> Series temporales y procesos estocásticos</a>
  <ul class="collapse">
  <li><a href="#ejemplos-para-clasificar" id="toc-ejemplos-para-clasificar" class="nav-link" data-scroll-target="#ejemplos-para-clasificar"><span class="header-section-number">6.2.1</span> Ejemplos para clasificar</a></li>
  </ul></li>
  <li><a href="#descripción-de-series-temporales" id="toc-descripción-de-series-temporales" class="nav-link" data-scroll-target="#descripción-de-series-temporales"><span class="header-section-number">6.3</span> Descripción de series temporales</a>
  <ul class="collapse">
  <li><a href="#función-de-autocorrelación-simple" id="toc-función-de-autocorrelación-simple" class="nav-link" data-scroll-target="#función-de-autocorrelación-simple"><span class="header-section-number">6.3.1</span> Función de autocorrelación simple</a></li>
  <li><a href="#función-de-autocorrelación-parcial" id="toc-función-de-autocorrelación-parcial" class="nav-link" data-scroll-target="#función-de-autocorrelación-parcial"><span class="header-section-number">6.3.2</span> Función de autocorrelación parcial</a></li>
  </ul></li>
  <li><a href="#serie-estacionaria" id="toc-serie-estacionaria" class="nav-link" data-scroll-target="#serie-estacionaria"><span class="header-section-number">6.4</span> Serie estacionaria</a>
  <ul class="collapse">
  <li><a href="#transformaciones-para-conseguir-estacionariedad" id="toc-transformaciones-para-conseguir-estacionariedad" class="nav-link" data-scroll-target="#transformaciones-para-conseguir-estacionariedad"><span class="header-section-number">6.4.1</span> Transformaciones para conseguir estacionariedad</a></li>
  </ul></li>
  <li><a href="#descomposición-de-una-serie-con-r" id="toc-descomposición-de-una-serie-con-r" class="nav-link" data-scroll-target="#descomposición-de-una-serie-con-r"><span class="header-section-number">6.5</span> Descomposición de una serie con R</a>
  <ul class="collapse">
  <li><a href="#conductas-de-series-temporales" id="toc-conductas-de-series-temporales" class="nav-link" data-scroll-target="#conductas-de-series-temporales"><span class="header-section-number">6.5.1</span> Conductas de series temporales</a></li>
  </ul></li>
  <li><a href="#métodos-armónicos" id="toc-métodos-armónicos" class="nav-link" data-scroll-target="#métodos-armónicos"><span class="header-section-number">6.6</span> Métodos armónicos</a></li>
  <li><a href="#en-resumen" id="toc-en-resumen" class="nav-link" data-scroll-target="#en-resumen"><span class="header-section-number">6.7</span> En resumen…</a></li>
  <li><a href="#modelización-univariante-de-series-temporales" id="toc-modelización-univariante-de-series-temporales" class="nav-link" data-scroll-target="#modelización-univariante-de-series-temporales"><span class="header-section-number">6.8</span> Modelización univariante de series temporales</a>
  <ul class="collapse">
  <li><a href="#procesos-autorregresivos-ar" id="toc-procesos-autorregresivos-ar" class="nav-link" data-scroll-target="#procesos-autorregresivos-ar"><span class="header-section-number">6.8.1</span> Procesos autorregresivos (AR)</a></li>
  <li><a href="#arp" id="toc-arp" class="nav-link" data-scroll-target="#arp"><span class="header-section-number">6.8.2</span> AR(p)</a></li>
  <li><a href="#ejemplo-práctico" id="toc-ejemplo-práctico" class="nav-link" data-scroll-target="#ejemplo-práctico"><span class="header-section-number">6.8.3</span> Ejemplo práctico</a></li>
  <li><a href="#modelos-de-media-móvil-ma" id="toc-modelos-de-media-móvil-ma" class="nav-link" data-scroll-target="#modelos-de-media-móvil-ma"><span class="header-section-number">6.8.4</span> Modelos de Media Móvil (MA)</a></li>
  <li><a href="#proceso-maq" id="toc-proceso-maq" class="nav-link" data-scroll-target="#proceso-maq"><span class="header-section-number">6.8.5</span> Proceso MA(q)</a></li>
  <li><a href="#ajuste-de-un-ma-a-la-serie-airpassengers" id="toc-ajuste-de-un-ma-a-la-serie-airpassengers" class="nav-link" data-scroll-target="#ajuste-de-un-ma-a-la-serie-airpassengers"><span class="header-section-number">6.8.6</span> Ajuste de un MA a la serie <code>AirPassengers</code></a></li>
  <li><a href="#qué-es-mejor-para-modelizar-la-serie-de-airpassengers-un-ar-o-un-ma" id="toc-qué-es-mejor-para-modelizar-la-serie-de-airpassengers-un-ar-o-un-ma" class="nav-link" data-scroll-target="#qué-es-mejor-para-modelizar-la-serie-de-airpassengers-un-ar-o-un-ma"><span class="header-section-number">6.8.7</span> ¿Qué es mejor para modelizar la serie de <code>AirPassengers</code> un AR o un MA?</a></li>
  </ul></li>
  <li><a href="#armapq" id="toc-armapq" class="nav-link" data-scroll-target="#armapq"><span class="header-section-number">6.9</span> ARMA(p,q)</a></li>
  <li><a href="#procesos-integrados" id="toc-procesos-integrados" class="nav-link" data-scroll-target="#procesos-integrados"><span class="header-section-number">6.10</span> Procesos Integrados</a>
  <ul class="collapse">
  <li><a href="#ejemplo-demostrativo-con-r" id="toc-ejemplo-demostrativo-con-r" class="nav-link" data-scroll-target="#ejemplo-demostrativo-con-r"><span class="header-section-number">6.10.1</span> Ejemplo demostrativo con R</a></li>
  <li><a href="#ejemplo-con-datos-reales" id="toc-ejemplo-con-datos-reales" class="nav-link" data-scroll-target="#ejemplo-con-datos-reales"><span class="header-section-number">6.10.2</span> Ejemplo con datos reales</a></li>
  <li><a href="#ljung-box-test" id="toc-ljung-box-test" class="nav-link" data-scroll-target="#ljung-box-test"><span class="header-section-number">6.10.3</span> Ljung Box test</a></li>
  <li><a href="#procesos-estacionales-sarimas" id="toc-procesos-estacionales-sarimas" class="nav-link" data-scroll-target="#procesos-estacionales-sarimas"><span class="header-section-number">6.10.4</span> Procesos estacionales: SARIMAs</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/AprendeR-UIB/AD/edit/main/t6_series_temporales.qmd" class="toc-action"><i class="bi bi-github"></i>Editar esta página</a></li><li><a href="https://github.com/AprendeR-UIB/AD/issues/new" class="toc-action"><i class="bi empty"></i>Informar de un problema</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Series temporales</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="introducción" class="level2" data-number="6.1">
<h2 data-number="6.1" class="anchored" data-anchor-id="introducción"><span class="header-section-number">6.1</span> Introducción</h2>
<p>El estudio de las series temporales es una rama fundamental en diversas disciplinas como la economía, la meteorología, la ingeniería, la medicina y muchas otras, ya que permite comprender la evolución y la variabilidad de una secuencia de observaciones registradas a lo largo del tiempo.</p>
<p>La identificación de tendencias, patrones cíclicos y comportamientos estacionales en series temporales proporciona valiosa información para construir modelos predictivos que ayuden en la toma de decisiones, la planificación estratégica y la anticipación de eventos futuros <span class="citation" data-cites="cryer">(véase <a href="referencias.html#ref-cryer" role="doc-biblioref">Jonathan D. Cryer 2008</a>)</span> y <span class="citation" data-cites="pena">(véase <a href="referencias.html#ref-pena" role="doc-biblioref">Peña 2010</a>)</span>.</p>
<section id="qué-es-una-serie-temporal" class="level3" data-number="6.1.1">
<h3 data-number="6.1.1" class="anchored" data-anchor-id="qué-es-una-serie-temporal"><span class="header-section-number">6.1.1</span> ¿Qué es una serie temporal?</h3>
<p>Una serie temporal es una sucesión de observaciones de una variable realizadas a <strong>intervalos regulares</strong> de tiempo.</p>
<p>El estudio de series temporales tiene por objeto analizar la evolución de una variable a través del tiempo.</p>
<p>La diferencia esencial con los análisis temporales es que <strong>las observaciones sucesivas no son independientes entre sí, y el análisis debe llevarse a cabo teniendo en cuenta el orden temporal de las observaciones</strong>. Por lo tanto, es muy importante conocer la periodicidad de los datos de las series que se están analizando.</p>
<p>La periodicidad puede ser:</p>
<ul>
<li><p>Anual: Se toma un dato cada año.</p></li>
<li><p>Mensual: Se toma un dato cada mes.</p></li>
<li><p>Semanal: Se toma un dato cada semana.</p></li>
<li><p>Diaria: Se toma un dato cada día.</p></li>
</ul>
<p>Por supuesto, existen muchos más tipos de periodicidad, como semestral o trimestral. El tipo de periodicidad va a ser algo importante en el análisis de la serie.</p>
<p><span style="color: blue;"><em>Ejemplos de series temporales</em></span></p>
<ol type="1">
<li><p>Serie del IPC en España. Esta serie puede ser anual o mensual.</p></li>
<li><p>Serie de Temperaturas en Mallorca. Esta serie suele ser mensual. Si fuera anual perderíamos mucha información, pues un invierno extremadamente frío puede compensarse con un verano muy cálido, de modo que la temperatura media del año sea templada.</p></li>
<li><p>Serie de ventas de una empresa. Este tipo de series puede ser anual, mensual o semanal.</p></li>
<li><p>Demanda de energía eléctrica. Esta serie suele obtenerse con periodicidad horaria.</p></li>
<li><p>Series de cotizaciones de bolsa. Este tipo de series se obtienen con la periodicidad que se quiera.</p></li>
</ol>
</section>
<section id="cómo-crear-una-serie-de-tiempo-en-r" class="level3" data-number="6.1.2">
<h3 data-number="6.1.2" class="anchored" data-anchor-id="cómo-crear-una-serie-de-tiempo-en-r"><span class="header-section-number">6.1.2</span> ¿Cómo crear una serie de tiempo en R?</h3>
<p>En R <code>ts</code> es la función genérica para que los datos tengan forma de serie temporal. Su sintaxis es la siguiente:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ts</span>(<span class="at">data =</span> <span class="cn">NA</span>, <span class="at">start =</span> <span class="dv">1</span>, <span class="at">end =</span> <span class="fu">numeric</span>(), <span class="at">frequency =</span> <span class="dv">1</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>donde:</p>
<ul>
<li><p>data: Vector, “data frame” o matriz de datos.</p></li>
<li><p>start: Referencia de la primera observacion, es un vector con dos valores numéricos, el primero relativo al año y el segundo relativo al trimestre y mes de inicio (1 para el primer trimestre y 1 para enero en series de datos mensuales).</p></li>
<li><p>end: Referencia de la ultima observación.</p></li>
<li><p>frequency: Número de observaciones por año (4 en series trimestrales, 12 en series mensuales).</p></li>
</ul>
<p>Un ejemplo de elaboración de un objeto “ts” es el siguiente:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ts</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="at">frequency =</span> <span class="dv">4</span>, <span class="at">start =</span> <span class="fu">c</span>(<span class="dv">1959</span>, <span class="dv">2</span>)) </span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Qtr1 Qtr2 Qtr3 Qtr4
1959         1    2    3
1960    4    5    6    7
1961    8    9   10     </code></pre>
</div>
</div>
<p>Para importar datos a R, usa la función <code>ts</code> de la siguiente manera. El inputData usado aquí es idealmente un vector numérico de clase “numeric” or “integer”.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ts</span>(inputData, <span class="at">frequency =</span> <span class="dv">4</span>, <span class="at">start =</span> <span class="fu">c</span>(<span class="dv">1959</span>, <span class="dv">2</span>)) <span class="co"># datos trimestrales</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ts</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="at">frequency =</span> <span class="dv">12</span>, <span class="at">start =</span> <span class="dv">1990</span>) <span class="co"># datos mensuales</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ts</span>(inputData, <span class="at">start=</span><span class="fu">c</span>(<span class="dv">2009</span>), <span class="at">end=</span><span class="fu">c</span>(<span class="dv">2014</span>), <span class="at">frequency=</span><span class="dv">1</span>) <span class="co"># datos anuales</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><span style="color: blue;"><em>Ejemplo</em></span></p>
<p>Consideremos el gasto mensual por persona (en €) de los turistas con destino principal las Islas Baleares por país de residencia en el período junio 2017 a junio 2019. Fuente: IBESTAT.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>gastos<span class="ot">=</span><span class="fu">read.table</span>(<span class="st">"datos/gastos_diarios_IB.txt"</span>,<span class="at">header=</span><span class="cn">TRUE</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(gastos) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'Fecha'</span>, <span class="st">'Uk'</span>,<span class="st">'Alemania'</span>, <span class="st">'Suiza'</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(gastos,<span class="dv">12</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Fecha     Uk Alemania  Suiza
1  2017-06 563.52   748.37  89.51
2  2017-07 734.13   751.15 143.11
3  2017-08 702.46   785.59  70.78
4  2017-09 546.31   703.69  36.39
5  2017-10 301.46   561.62  60.01
6  2017-11  19.80    86.72  10.24
7  2017-12  17.55    46.23     NA
8  2018-01  16.70    51.89     NA
9  2018-02  14.80    77.56     NA
10 2018-03  50.43   219.53  13.35
11 2018-04 165.01   363.07  37.12
12 2018-05 414.05   578.02  57.94</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>gastos.ts <span class="ot">&lt;-</span> <span class="fu">ts</span>(gastos[<span class="sc">-</span><span class="dv">1</span>], <span class="at">start =</span> <span class="fu">c</span>(<span class="dv">2017</span>,<span class="dv">6</span>), <span class="at">frequency =</span> <span class="dv">12</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(gastos.ts)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         Uk Alemania  Suiza
[1,] 563.52   748.37  89.51
[2,] 734.13   751.15 143.11
[3,] 702.46   785.59  70.78
[4,] 546.31   703.69  36.39
[5,] 301.46   561.62  60.01
[6,]  19.80    86.72  10.24</code></pre>
</div>
</div>
</section>
</section>
<section id="series-temporales-y-procesos-estocásticos" class="level2" data-number="6.2">
<h2 data-number="6.2" class="anchored" data-anchor-id="series-temporales-y-procesos-estocásticos"><span class="header-section-number">6.2</span> Series temporales y procesos estocásticos</h2>
<p>Los fenómenos dinámicos que observamos mediante series temporales pueden considerarse como una realización de un <strong>proceso aleatorio o estocástico</strong>.</p>
<p>Un <span style="color: blue;"><em>proceso estocástico</em></span> (o aleatorio) es un conjunto de variables aleatorias <span class="math inline">\(\{X_t\}\)</span> donde el índice <span class="math inline">\(t\)</span> toma valores en un cierto conjunto <span class="math inline">\(C\)</span>. En el caso de las series temporales, este conjunto es ordenado y corresponde a los instantes temporales (días, meses, años, etc.).</p>
<p>Para cada valor <span class="math inline">\(t\)</span> del conjunto <span class="math inline">\(C\)</span>, la variable aleatoria, <span class="math inline">\(X_t\)</span>, toma un valor y, el conjunto de los valores observados en distintos instantes forman una serie temporal.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="Figuras/proceso_estocastico.png" class="lightbox" data-gallery="quarto-lightbox-gallery-1"><img src="Figuras/proceso_estocastico.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:90.0%"></a></p>
</figure>
</div>
<p>Por tanto, una manera más formal de definir una serie temporal es como una sucesión de observaciones de una variable tomadas en varios instantes de tiempo. Estas observaciones provienen de una distribución que puede ser diferente en cada instante del tiempo.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="Figuras/proceso_estocastico2.png" class="lightbox" data-gallery="quarto-lightbox-gallery-2"><img src="Figuras/proceso_estocastico2.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:60.0%"></a></p>
</figure>
</div>
<p>Dependiendo de los valores que toma la serie:</p>
<ul>
<li><p>Tiempo continuo: cuando el valor de la variable puede cambiar en cualquier momento (ej: velocidad del viento).</p></li>
<li><p>Tiempo discreto: cuando el valor de la variable puede cambiar en una serie de momentos determinados del tiempo.</p></li>
<li><p>Valores continuos: cada variable puede tomar cualquier valor comprendido en un rango (ej: temperatura).</p></li>
<li><p>Valores discretos: cada variable sólo puede tomar determinados valores discretos. (ej: activos cuyos precios oscilan de céntimos de € en céntimos de €).</p></li>
</ul>
<p><strong>Ejemplo:</strong></p>
<p>Consideremos un proceso estocástico que se conoce como “paseo aleatorio (ramdom walk)”, definido de la siguiente forma: <span class="math display">\[x_t=\sum_{j=0}^t a_j,\]</span> donde <span class="math inline">\(a_j \mathop {\sim}\limits^{iid} N(0, \sigma)\)</span> se conoce como <strong>ruido blanco Gaussiano</strong>.</p>
<p><span style="color: red;"><em>Ejercicio</em></span>: Dibujad con <code>R</code>, tres trayectorias de tamaño 300 de un paseo aleatorio con <span class="math inline">\(\sigma^2= 1\)</span>. Agregad una leyenda al gráfico y las etiquetas de los ejes. Entregad el fichero y su compilación en Aula Digital.</p>
<p>Un proceso estocástico queda caracterizado por el conjunto de todas las distribuciones finito-dimensionales.</p>
<p><strong>La distribución n-dimensional de un proceso</strong>: Es la función de distribución de un conjunto de <span class="math inline">\(n\)</span> variables del proceso <span class="math inline">\((X_1,\ldots, X_n)\)</span>, es decir, <span class="math display">\[F(x_1,\ldots, x_n) = P(x_1 \leq x_1,\ldots, X_n ≤ x_n), \; \; n \in N \]</span></p>
<p>No somos capaces de tratar cualquier tipo de serie temporal, ya que en cada instante tenemos una variable con distinta distribución de la que sólo observamos un dato.</p>
<p>Para un proceso de tamaño <span class="math inline">\(T\)</span>, habría que estimar <span class="math inline">\(T\)</span>-medias, <span class="math inline">\(T\)</span>-varianzas, y <span class="math inline">\(T(T-1)/2\)</span>-autocovarianzas. No disponemos de información suficiente.</p>
<p><strong>Necesitamos imponer condiciones a la serie</strong></p>
<p>Un proceso estocástico <span class="math inline">\((Y_t)_{t\in Z}\)</span> es:</p>
<ul>
<li><p>Estable en media: si <span class="math inline">\(\mu_t=\mu=cte\)</span></p></li>
<li><p>Estable en varianza: si <span class="math inline">\(\sigma^2_t=\sigma^2_y=cte\)</span></p></li>
<li><p>`Estable en autocovarianza: si <span class="math inline">\(\gamma_{t_1,t_1+h}=\gamma_{t_2,t_2+h}=\gamma_h\)</span> para cualquier par de instantes <span class="math inline">\(t_1,t_2 \in Z\)</span> y cualquier <span class="math inline">\(h \in Z\)</span>.</p></li>
<li><p>Estacionario en sentido débil: si es estable en media y en autocovarianza.</p></li>
<li><p>Estacionario en sentido estricto: si las distribuciones marginales de todas las variables son idénticas y además la distribución finito-dimensional de cualquier conjunto de variables sólo depende de los retardos. Es decir, si <span class="math display">\[F_{t_1,\ldots,t_k}(y_1,\ldots,y_k)=F_{t_1+h,\ldots,t_k+h}(y_1,\ldots,y_k)\]</span> para cualquier <span class="math inline">\(k \in N\)</span>, <span class="math inline">\(t_1,\ldots,t_k\)</span>, <span class="math inline">\(h \in Z\)</span>, y <span class="math inline">\(y_1,\ldots,y_k \in R\)</span>, donde <span class="math inline">\(F_{t_1,\ldots,t_k}\)</span> denota la distribución conjunta de <span class="math inline">\(Y_{t_1},\ldots, Y_{t_k}\)</span>.</p></li>
</ul>
<section id="ejemplos-para-clasificar" class="level3" data-number="6.2.1">
<h3 data-number="6.2.1" class="anchored" data-anchor-id="ejemplos-para-clasificar"><span class="header-section-number">6.2.1</span> Ejemplos para clasificar</h3>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="t6_series_temporales_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="descripción-de-series-temporales" class="level2" data-number="6.3">
<h2 data-number="6.3" class="anchored" data-anchor-id="descripción-de-series-temporales"><span class="header-section-number">6.3</span> Descripción de series temporales</h2>
<p>Una vez que has leído una serie de tiempo en R, el siguiente paso suele ser hacer un gráfico que muestre la evolución de la serie en el tiempo. Esto se puede hacer con la función <code>plot.ts</code> de R.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot.ts</span>(gastos.ts)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="t6_series_temporales_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Pero, en el caso en que tenemos varias series tomadas en el mismo instante de tiempo, podemos utilizar las siguientes instrucciones para visualizar mejor.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(gastos.ts, <span class="at">plot.type=</span><span class="st">"single"</span>, </span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">col =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(gastos.ts), <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1000</span>),</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">"Fecha"</span>, </span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab=</span><span class="st">"Gasto mensual por persona en €"</span>)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"topright"</span>, <span class="fu">colnames</span>(gastos.ts), <span class="at">col=</span><span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(gastos.ts), <span class="at">lty=</span><span class="dv">1</span>, <span class="at">cex=</span>.<span class="dv">65</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="t6_series_temporales_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Si queremos ubicar dónde se producen los ciclos (movimientos de carácter periódico), podemos utilizar un gráfico de cajas y bigotes como el siguiente:</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="t6_series_temporales_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Otras ideas para visualizar series temporales:</p>
<ul>
<li><p><a href="https://rkabacoff.github.io/datavis/Time.html#TimeSeries">ggplot</a></p></li>
<li><p><a href="https://www.r-bloggers.com/2020/06/time-series-in-5-minutes-part-1-visualization-with-the-time-plot/">R-bloggers</a></p></li>
</ul>
<p>Además de identificar los ciclos, cuando visualizamos una(s) serie(s) temporal(es) se suele prestar atención a las siguientes características:</p>
<ul>
<li><span style="color: blue;"><em>Tendencia</em></span>: Se refiere a si la serie tiende a crecer o decrecer a largo plazo. Por ejemplo:</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(co2)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot.ts</span>(co2)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="t6_series_temporales_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Cuando una serie permanece más o menos constante, oscilando en torno a un valor, decimos que la serie no tiene tendencia.</p>
<p><a href="Figuras/SinTendencia.png" class="lightbox" data-gallery="tendencias"><img src="Figuras/SinTendencia.png" class="img-fluid"></a></p>
<ul>
<li><span style="color: blue;"><em>Variabilildad</em></span>: Decimos que una serie es <strong>Homocedástica</strong>, si su variabilidad se mantiene constante a lo largo de la serie. Cuando la variabilidad de la serie aumenta o disminuye a lo largo del tiempo, decimos que la serie es <strong>Heterocedástica</strong>. La siguiente figura muestra una serie heterocedástica en la que la varianza va aumentando con el tiempo.</li>
</ul>
<p><a href="Figuras/Heterocedastico.png" class="lightbox" data-gallery="tendencias"><img src="Figuras/Heterocedastico.png" class="img-fluid"></a></p>
<p>Una serie puede tener tendencia y ser heterocedástica</p>
<p><a href="Figuras/TendenciaHeterocedastico.png" class="lightbox" data-gallery="tendencias"><img src="Figuras/TendenciaHeterocedastico.png" class="img-fluid"></a></p>
<ul>
<li><span style="color: blue;"><em>Estacionalidad</em></span>: Corresponde a aquellos <strong>comportamientos de tipo regular y repetitivo</strong> que se dan a lo largo de un período de tiempo, generalmente igual o inferior a un año, y que son producidos por factores tales como las variaciones climatológicas, las vacaciones, las fiestas, etc.</li>
</ul>
<p>No confundas estacionalidad con <strong>fluctuación cíclica</strong>, que refleja los movimientos de carácter periódico, pero no necesariamente regulares, a medio plazo en torno a la tendencia.</p>
<p>Veamos si puedes identificar el tipo de comportamiento que presenta la siguiente serie</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="t6_series_temporales_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Hasta ahora hemos descrito el aspecto de la serie. Sin embargo, cuando se quiere analizar la serie es necesario identificar la estructura que la genera, es decir <strong>cómo influyen las observaciones del pasado en las observaciones del futuro</strong>.</p>
<section id="función-de-autocorrelación-simple" class="level3" data-number="6.3.1">
<h3 data-number="6.3.1" class="anchored" data-anchor-id="función-de-autocorrelación-simple"><span class="header-section-number">6.3.1</span> Función de autocorrelación simple</h3>
<p>La función de autocovarianza de un proceso estocástico <span class="math inline">\((Y_t)\)</span> es una función de <span class="math inline">\(t\)</span> que proporciona las covarianzas entre las variables del proceso en cada par de instantes: <span class="math display">\[\gamma_{t_1,t_2}=Cov(Y_{t_1},Y_{t_2})=E[(Y_{t_1}-\mu_{t_1})(Y_{t_2}-\mu_{t_2})], \, \, t_1,t_2 \in I\]</span></p>
<p>La <span style="color: blue;"><em>función de autocorrelación</em></span> de un proceso estocástico <span class="math inline">\((Y_t)\)</span> es una función de dos instantes de tiempo que describe las correlaciones entre las variables en un par de instantes <span class="math inline">\(t_1,t_2 \in I:\)</span><span class="math inline">\(\rho_{t_1,t_2}=Cor(Y_{t_1},Y_{t_2})=\frac{\gamma_{t_1,t_2}}{\sigma_{t_1}\sigma_{t_2}}, \; \;  t_1,t_2 \in I\)</span>$</p>
<p>La función de autocorrelación simple es una serie que proporciona la estructura de dependencia lineal de la misma.</p>
<p>Si los valores observados de la serie son: <span class="math inline">\(y_1,y_2,\ldots,y_{t-2},y_{t-1},y_{t}\)</span>. Entonces, <span class="math inline">\(y_{t+1}\)</span> representa el valor de la serie para próximo periodo, es decir un valor futuro.</p>
<p>Luego, la función de autocorrelación proporciona el coeficiente de correlación entre las observaciones separadas un número determinado de periodos. Así la FAS (<code>ACF</code> en R), va a ser una sucesión de números:</p>
<ul>
<li><p><span class="math inline">\(\rho_1\)</span> indica cómo influye una observación sobre la siguiente: <span class="math inline">\(y_i \rightarrow y_{i+1}\)</span>.</p></li>
<li><p><span class="math inline">\(\rho_2\)</span> indica cómo influye una observación sobre la que está dos periodos en adelante: <span class="math inline">\(y_i \rightarrow y_{i+2}\)</span>.</p></li>
<li><p><span class="math inline">\(\rho_3\)</span> indica cómo influye una observación sobre la que está tres periodos en adelante: <span class="math inline">\(y_i \rightarrow y_{i+3}\)</span>.</p></li>
<li><p>Y así sucesivamente</p></li>
</ul>
<p>Los coeficientes de la FAS, <span class="math inline">\(\rho_1, \cdots, \rho_k,\cdots\)</span> están acotados entre <span class="math inline">\([-1,1]\)</span>. Cuando un <span class="math inline">\(\rho_i\)</span> vale cero, quiere decir que no existe efecto entre una observación y la <span class="math inline">\(i\)</span> posiciones posteriores.</p>
<p>Si <span class="math inline">\(\rho_i\)</span> es próximo a 1 indica que hay mucha relación entre una observación y la <span class="math inline">\(i\)</span> posiciones posteriores, y que esa relación es positiva.</p>
<p>Si <span class="math inline">\(\rho_i\)</span> es próximo a -1 indica que hay mucha relación entre una observación y la <span class="math inline">\(i\)</span> posiciones posteriores, y que esa relación es negativa.</p>
<p><strong>La FAS proporciona cómo una observación influye sobre las posteriores.</strong></p>
<p><span style="color: blue;"><em>Ejemplo</em></span>:</p>
<p>Serie del consumo mensual de gasolina en España 1/1966 - 8/1977</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="t6_series_temporales_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="t6_series_temporales_files/figure-html/unnamed-chunk-11-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>En el gráfico de la FAS anterior (ACF) se observa que los coeficientes (o barras) son significativos para retardos 1,2,3 y luego esto se repite para 11,12,13.</p>
<p>Las bandas horizontales que se observan proporcionan los límites para considerar significativo un retardo.</p>
<p>Pero, la FAS tiene un problema, y es que si por ejemplo <span class="math inline">\(\rho_1\)</span> es distinto de cero, entonces: <span class="math display">\[y_1 \rightarrow y_2  \rightarrow \cdots \rightarrow y_{t-1} \rightarrow y_{t} \rightarrow y_{t+1} \cdots \]</span> es decir existe una cadena de influencia separada por un retardo. Pero si <span class="math inline">\(y_1 \rightarrow y_2\)</span> y <span class="math inline">\(y_2 \rightarrow y_3\)</span>, entonces <span class="math inline">\(y_1 \rightarrow y_3\)</span>.</p>
<p>Por tanto, la ACF en general, si <span class="math inline">\(\rho_1\)</span> es distinto de cero, encontrará que <span class="math inline">\(\rho_2, \rho_3, \cdots\)</span> serán distintos de cero.</p>
<p>Pero, es necesario distinguir la cadena de influencia general, a través de <span class="math inline">\(\rho_1\)</span> y las cadenas de influencia directa. Es decir cómo influye <span class="math inline">\(y_1\)</span> sobre <span class="math inline">\(y_3\)</span> directamente, es decir <strong>SIN PASAR A TRAVÉS DE</strong> <span class="math inline">\(y_2\)</span>.</p>
</section>
<section id="función-de-autocorrelación-parcial" class="level3" data-number="6.3.2">
<h3 data-number="6.3.2" class="anchored" data-anchor-id="función-de-autocorrelación-parcial"><span class="header-section-number">6.3.2</span> Función de autocorrelación parcial</h3>
<p>La Función de autocorrelación parcial, que en R es la función <code>PACF</code> proporciona la relación directa que existe entre observaciones separadas por <span class="math inline">\(k\)</span> retardos.</p>
<p>Esta es una información muy valiosa sobre la estructura de la serie, ya que elimina el problema que presentaba la función de autocorrelación simple.</p>
<p><span style="color: blue;"><em>Ejemplo</em></span>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>y<span class="ot">=</span><span class="fu">cumsum</span>(<span class="fu">rnorm</span>(<span class="dv">300</span>,<span class="dv">0</span>,<span class="dv">1</span>))</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot.ts</span>(y)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="t6_series_temporales_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">acf</span>(y)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="t6_series_temporales_files/figure-html/unnamed-chunk-12-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pacf</span>(y)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="t6_series_temporales_files/figure-html/unnamed-chunk-12-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="serie-estacionaria" class="level2" data-number="6.4">
<h2 data-number="6.4" class="anchored" data-anchor-id="serie-estacionaria"><span class="header-section-number">6.4</span> Serie estacionaria</h2>
<p>En general, diremos que una serie es estacionaria cuando cumple las siguientes características:</p>
<ul>
<li><p>No tiene tendencia</p></li>
<li><p>Es homocedástica.</p></li>
<li><p>No tiene ciclos estacionales</p></li>
<li><p>La estructura de dependencia se mantiene constante, es decir si una observación influye sobre la posterior, ésto ocurre SIEMPRE. Esta condición es importante para modelizar la serie, pues si el fenómeno que genera la serie cambia, es imposible que podamos prever la evolución de la serie.</p></li>
<li><p>La influencia de las observaciones sobre las posteriores decrece con el tiempo.</p></li>
</ul>
<section id="transformaciones-para-conseguir-estacionariedad" class="level3" data-number="6.4.1">
<h3 data-number="6.4.1" class="anchored" data-anchor-id="transformaciones-para-conseguir-estacionariedad"><span class="header-section-number">6.4.1</span> Transformaciones para conseguir estacionariedad</h3>
<p>Cuando la serie no les estacionaria, es preciso transformarla.</p>
<p><strong>Para eliminar la tendencia</strong> se toman una o varias diferencias en la serie. Una serie se diferencia restando a cada observación la observación anterior: <span class="math display">\[w_t= y_t - y_{t-1}\]</span></p>
<p>Evidentemente la serie diferenciada <span class="math inline">\(w\)</span> tiene una observación menos que la serie original, ya que la primera observación se pierde.</p>
<p>Si el gráfico de una serie muestra tendencia, se diferencia la serie y se comprueba si ha perdido la tendencia. En caso de que no la haya perdido se diferencia una segunda vez. Es muy raro necesitar más de una o dos diferencias para eliminar la tendencia de una serie.</p>
<p>Normalmente se utiliza la nomenclatura <span class="math inline">\(\Delta y_t= w_t\)</span> para representar la serie con una diferencia.</p>
<p><span style="color: blue;"><em>Ejemplo</em></span>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>gas.ts <span class="ot">=</span> <span class="fu">ts</span>(gas, <span class="at">start =</span> <span class="fu">c</span>(<span class="dv">1966</span>,<span class="dv">1</span>), <span class="at">frequency =</span> <span class="dv">12</span>)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(gas.ts)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="fu">acf</span>(gas.ts)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="t6_series_temporales_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>En la ACF se observa una pauta que aparece cuando la serie tiene tendencia y por tanto no es estacionaria: las barras disminuyen muy lentamente.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>w <span class="ot">=</span> <span class="fu">diff</span>(x)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot.ts</span>(w)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="fu">acf</span>(w)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="t6_series_temporales_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>La serie ya no tiene tendencia, y su ACF decrece rápidamente.</p>
<p><strong>Estabilización de la varianza</strong>:</p>
<p>Para estabilizar la variabilidad se suelen tomar logaritmos antes de aplicar diferencias en la serie</p>
<p>Posteriormente, cuando vayamos a hacer la predicción de la serie habrá que deshacer las diferencias y aplicando antilogaritmos según convenga.</p>
<p><strong>Eliminar una tendencia no constante</strong></p>
<p><span style="color: blue;"><em>Ejemplo</em></span>: Si tenemos una serie mensual, podemos usar una media móvil de 12 meses: <span class="math display">\[\hat{\mu_t}=\frac{z_{t-5}+ \cdots + z_{t+5}+ z_{t+6}}{12},\]</span></p>
<p>Aplicando este método se obtiene una estimación del nivel de la serie en los instantes <span class="math inline">\(t=6, \ldots, T-6\)</span>.</p>
<p>Para obtener los valores del nivel en los extremos se ajusta una recta a los últimos valores y de esta manera se completa la serie de niveles.</p>
<p>Una vez identificados los componentes determinísticos (tendencia y estacionalidad) y después de haberlos eliminado, <strong>persisten unos valores que son aleatorios</strong>.</p>
<p>Se pretende estudiar qué tipo de comportamiento aleatorio presentan estos residuos, utilizando algún tipo de modelo probabilístico que los describa.</p>
</section>
</section>
<section id="descomposición-de-una-serie-con-r" class="level2" data-number="6.5">
<h2 data-number="6.5" class="anchored" data-anchor-id="descomposición-de-una-serie-con-r"><span class="header-section-number">6.5</span> Descomposición de una serie con R</h2>
<p>Los métodos de descomposición tratan de separar la serie en subseries correspondientes a la tendencia, la estacionalidad y el ruido (componente aleatorio).</p>
<p>El primer paso a seguir a la hora de descomponer una serie es determinar cómo se combinan sus componentes.</p>
<p><span style="color: blue;"><em>Caso aditivo</em></span>:</p>
<p><span class="math display">\[y_t= \mu_t + S_t + a_t\]</span></p>
<p><span style="color: blue;"><em>Caso multiplicativo</em></span>:</p>
<p>El efecto estacional tiende a aumentar al aumentar la tendencia. <span class="math display">\[y_t= \mu_t \times S_t \times a_t\]</span></p>
<section id="conductas-de-series-temporales" class="level3" data-number="6.5.1">
<h3 data-number="6.5.1" class="anchored" data-anchor-id="conductas-de-series-temporales"><span class="header-section-number">6.5.1</span> Conductas de series temporales</h3>
<p><a href="Figuras/conductas_st.png" class="lightbox" data-gallery="quarto-lightbox-gallery-6"><img src="Figuras/conductas_st.png" class="img-fluid" style="width:100.0%"></a></p>
<p>El procedimiento de construcción del modelo se realiza en tres etapas:</p>
<ol type="1">
<li>Se estima el nivel de la serie observada con el modelo de tendencias deterministas que se fundamenta en modelar la dependencia temporal mediante las ideas de regresión.</li>
</ol>
<p><span style="color: blue;"><em>Modelo</em></span>:</p>
<p>Suponemos que la serie se puede descomponer de la siguiente forma: <span class="math display">\[ y_t=\mu_t+a_t, \;\;\;  t=1,\ldots,n\]</span></p>
<ul>
<li><p><span class="math inline">\(\mu_t=f(t,\mathbf{\beta})\)</span> es el nivel de la serie depende del tiempo y de un vector de parámetros, <span class="math inline">\(\mathbf{\beta}\)</span> que se estiman a partir de los datos.</p></li>
<li><p><span class="math inline">\(a_t\)</span>, se denomina error aleatorio (o innovación) en el instante <span class="math inline">\(t\)</span>: recoge todos los demás efectos que actuan sobre la serie. Se supone que tiene una estructura estable a lo largo del tiempo: <span class="math inline">\(a_t \mathop {\sim}\limits^{iid} N(0, \sigma)\)</span>.</p></li>
</ul>
<p>Habitualmente <span class="math inline">\(\mathbf{\beta}\)</span> se obtiene utilizando el método de mínios cuadrados; es decir, resolviendo el problema: <span class="math display">\[\min_{\mathbf{\beta}}\sum_{t=0}^n [y_t-f(t,\mathbf{\beta})]^2\]</span></p>
<p>Derivando la función <span class="math inline">\(f(t,\mathbf{\beta})=\sum_{t=0}^n [y_t-f(t,\mathbf{\beta})]^2\)</span> respecto de los elementos de <span class="math inline">\(\mathbf{\beta}\)</span> e igualando a cero, se obtienen las ecuaciones normales. El estimador mínimo cuadrático <span class="math inline">\(\hat{\mathbf{\beta}}\)</span> es la solución a dichas ecuaciones.</p>
<p>La tendencia estimada es <span class="math inline">\(\hat{\mu_t}=f(t,\hat{\mathbf{\beta}})\)</span>, donde <span class="math inline">\(\hat{\mathbf{\beta}}\)</span> es un estimador de <span class="math inline">\(\mathbf{\beta}\)</span></p>
<ol start="2" type="1">
<li>A continuación se resta a la serie el nivel estimado para obtener una serie residual, que se denomina <strong>serie sin tendencia</strong>: <span class="math display">\[E_t=y_t - \hat{\mu}_t=S_t + a_t\]</span></li>
</ol>
<p>Una forma sencilla de estimar el efecto de las <span class="math inline">\(l\)</span> distintas estaciones es:</p>
<ul>
<li><p>Calcular la media de la serie sin tendencia: <span class="math inline">\(\bar{e}=n^{-1}\sum_{t=1}^{n}e_t\)</span>.</p></li>
<li><p>Calcular las medias de cada estación: <span class="math inline">\(\bar{e}_j=m^{-1}\sum_{k=1}^{m}e_{(k-1)l+j}, \;\; j=1,\ldots,l\)</span>.</p></li>
<li><p>Las componentes estacionales se estiman mediante: <span class="math display">\[\widehat{s}_j=\overline{e}_j - \overline{e}  \;\; j=1,\ldots,l\]</span> y verifican que <span class="math inline">\(\sum_{j=1}^{l}\widehat{s}_j=0\)</span></p></li>
</ul>
<p>Se obtiene la serie de residuos restando la serie sin tendencia el factor estacional de cada observación: <span class="math display">\[ \hat{a}_t=E_t- \hat{S}_j\]</span>.</p>
<p>La predicción de la serie se realiza sumando las estimaciones de la tendencia y el factor estacional que corresponde a cada observación.</p>
<p>Si la variabilidad de los datos parece crecer con su nivel, podemos suponer un `<span style="color: blue;"><em>Caso multiplicativo</em></span>:.</p>
<p>Tomando logaritmos y renombrando las componentes se obtiene un modelo aditivo.</p>
<p><span style="color: blue;"><em>Ejemplo de descomposición de una serie</em></span>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>datos<span class="ot">=</span><span class="fu">read.table</span>(<span class="st">"datos/precio_vestido.txt"</span>,<span class="at">header=</span><span class="cn">TRUE</span>)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Ajustamos una tendencia lineal</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>x<span class="ot">=</span><span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(datos<span class="sc">$</span>vestido)</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>tendencia<span class="ot">=</span><span class="fu">lm</span>(datos<span class="sc">$</span>vestido <span class="sc">~</span> x)</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Restamos esta recta a la serie</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>e<span class="ot">=</span>datos<span class="sc">$</span>vestido<span class="sc">-</span>tendencia<span class="sc">$</span>fitted.values</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>e_ts<span class="ot">=</span><span class="fu">ts</span>(e,<span class="at">start =</span> <span class="fu">c</span>(<span class="dv">1993</span>,<span class="dv">1</span>),<span class="at">frequency =</span> <span class="dv">12</span>)</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>precio_vestido<span class="ot">=</span><span class="fu">ts</span>(datos<span class="sc">$</span>vestido,<span class="at">start =</span> <span class="fu">c</span>(<span class="dv">1993</span>,<span class="dv">1</span>),<span class="at">frequency =</span> <span class="dv">12</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ts.plot</span>(precio_vestido,<span class="at">xlab=</span><span class="st">"Tiempo"</span>,<span class="at">ylab=</span><span class="st">"Precios vestidos"</span>)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ts.plot</span>(e_ts,<span class="at">xlab=</span><span class="st">"Tiempo"</span>,<span class="at">ylab=</span><span class="st">"Serie sin tendencia"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="t6_series_temporales_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>El comando <code>cycle</code> determina la unidad de tiempo a la que pertenece cada observación de la serie.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cycle</span>(e_ts)  </span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec
1993   1   2   3   4   5   6   7   8   9  10  11  12
1994   1   2   3   4   5   6   7   8   9  10  11  12
1995   1   2   3   4   5   6   7   8   9  10  11  12
1996   1   2   3   4   5   6   7   8   9  10  11  12
1997   1   2   3   4   5   6   7   8   9  10  11  12
1998   1   2   3   4   5   6   7   8   9  10  11  12
1999   1   2   3   4   5   6   7   8   9  10  11  12
2000   1   2   3   4   5   6   7   8   9  10  11  12
2001   1   2   3   4   5   6   7   8   9  10  11  12</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>e_barra<span class="ot">=</span><span class="fu">mean</span>(e_ts) <span class="co">#media de la serie sin tendencia</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>s<span class="ot">=</span><span class="fu">rep</span>(<span class="dv">0</span>,<span class="dv">12</span>) <span class="co">#vector para los coeficientes estacionales</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>)</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>  indice_j<span class="ot">=</span><span class="fu">seq</span>(j,<span class="dv">108</span>,<span class="at">by=</span><span class="dv">12</span>)</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>  s[j]<span class="ot">=</span><span class="fu">mean</span>(e_ts[indice_j])<span class="sc">-</span>e_barra</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a><span class="co">#Calculamos los residuos</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>s_compl<span class="ot">=</span><span class="fu">rep</span>(s,<span class="dv">9</span>) </span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>a<span class="ot">=</span>e_ts<span class="sc">-</span>s_compl</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot.ts</span>(a,<span class="at">xlab=</span><span class="st">"Tiempo"</span>,<span class="at">ylab=</span><span class="st">"Residuos"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="t6_series_temporales_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>serie<span class="ot">=</span><span class="fu">ts</span>(datos<span class="sc">$</span>vestido,<span class="at">start=</span><span class="fu">c</span>(<span class="dv">1993</span>,<span class="dv">1</span>),<span class="at">frequency =</span> <span class="dv">12</span>)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">decompose</span>(serie))</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="t6_series_temporales_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Los valores estimados de los componentes estacionales, de tendencia e irregulares ahora se almacenan en variables: <code>descompose(serie)$trend</code>, <code>descompose(serie)$seasonal</code> y <code>descompose(serie)$random</code>.</p>
<p>Por ejemplo, podemos imprimir los valores estimados del componente estacional escribiendo:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">decompose</span>(serie)<span class="sc">$</span>seasonal</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              Jan          Feb          Mar          Apr          May
1993  0.078689236 -0.092664931 -0.077039931  0.186501736  0.172960069
1994  0.078689236 -0.092664931 -0.077039931  0.186501736  0.172960069
1995  0.078689236 -0.092664931 -0.077039931  0.186501736  0.172960069
1996  0.078689236 -0.092664931 -0.077039931  0.186501736  0.172960069
1997  0.078689236 -0.092664931 -0.077039931  0.186501736  0.172960069
1998  0.078689236 -0.092664931 -0.077039931  0.186501736  0.172960069
1999  0.078689236 -0.092664931 -0.077039931  0.186501736  0.172960069
2000  0.078689236 -0.092664931 -0.077039931  0.186501736  0.172960069
2001  0.078689236 -0.092664931 -0.077039931  0.186501736  0.172960069
              Jun          Jul          Aug          Sep          Oct
1993  0.008897569 -0.152560764 -0.325477431 -0.348394097  0.016710069
1994  0.008897569 -0.152560764 -0.325477431 -0.348394097  0.016710069
1995  0.008897569 -0.152560764 -0.325477431 -0.348394097  0.016710069
1996  0.008897569 -0.152560764 -0.325477431 -0.348394097  0.016710069
1997  0.008897569 -0.152560764 -0.325477431 -0.348394097  0.016710069
1998  0.008897569 -0.152560764 -0.325477431 -0.348394097  0.016710069
1999  0.008897569 -0.152560764 -0.325477431 -0.348394097  0.016710069
2000  0.008897569 -0.152560764 -0.325477431 -0.348394097  0.016710069
2001  0.008897569 -0.152560764 -0.325477431 -0.348394097  0.016710069
              Nov          Dec
1993  0.307855903  0.224522569
1994  0.307855903  0.224522569
1995  0.307855903  0.224522569
1996  0.307855903  0.224522569
1997  0.307855903  0.224522569
1998  0.307855903  0.224522569
1999  0.307855903  0.224522569
2000  0.307855903  0.224522569
2001  0.307855903  0.224522569</code></pre>
</div>
</div>
</section>
</section>
<section id="métodos-armónicos" class="level2" data-number="6.6">
<h2 data-number="6.6" class="anchored" data-anchor-id="métodos-armónicos"><span class="header-section-number">6.6</span> Métodos armónicos</h2>
<p>Un procedimiento alternativo para modelar la estacionalidad es representar la serie por una función armónica de su periodo <span class="math inline">\(l\)</span>.</p>
<p>Suponiendo que hemos eliminado la tendencia, si la huviese, consideremos series que tienen sólo componente estacional <span style="color: ;"><em>con cliclo único</em></span>:red, es decir: <span class="math display">\[y_t=S_t+a_t\]</span></p>
<p>La estacionalidad se puede capturar con una función seno o coseno, de la siguiente forma:</p>
<p><span class="math display">\[S_t=A \sin((2\pi/l)t+\theta),\]</span> donde:</p>
<ul>
<li><p><span class="math inline">\(l\)</span> es el periodo: número de observaciones hasta que la serie se repite.</p></li>
<li><p><span class="math inline">\(A\)</span> es la amplitud de la oscilación.</p></li>
<li><p><span class="math inline">\(\theta\)</span> es el ángulo de desfase con relación al comienzo del ciclo.</p></li>
<li><p><span class="math inline">\(f=1/l\)</span> se denomina <strong>frecuencia</strong> de la serie. Es la fracción de ciclo completado entre dos observaciones de la serie. Si <span class="math inline">\(l&lt;1\)</span>, entonces <span class="math inline">\(f&gt;1\)</span> es el número de ciclos que pasan entre dos observaciones.</p></li>
</ul>
<p><strong>Ejemplo</strong>:</p>
<p>Una serie trimestral (<span class="math inline">\(l=4\)</span>), la frecuencia es <span class="math inline">\(f=\frac{1}{4}=0.25\)</span>, indicando que entre dos observaciones, un trimestre, ha transcurrido 0.25 del periodo de la función o un 25% de un ciclo completo.</p>
<ul>
<li><span class="math inline">\(w=2 \pi /l=2 \pi f\)</span> es la frecuencia angular, o ángulo (en radianes) recorrido entre dos observaciones de la serie. Para <span class="math inline">\(l=365 \implies w=0.0172\)</span>.</li>
</ul>
<p>Para capturar series de múltiples ciclos, usaremos la representación de Fourier: toda función periódica puede representarse como suma de funciones sinusoidales de distinta amplitud y frecuencia.</p>
<p>Dada una serie de longitud <span class="math inline">\(n\)</span>, se denomina <strong>periodos básicos o de Fourier</strong> a los que son fracciones exactas completas del tamaño muestral. Es decir, <span class="math display">\[s_j=\frac{n}{j}, \; \; para \; \;  j=1,2,\ldots n/2\]</span></p>
<p>Podemos obtener una representación general de una función periódica como suma de ondas asociadas a todas las frecuencias básicas, mediante: <span class="math display">\[y_t=\mu+\displaystyle\sum_{j=1}^{n/2} A_j sen(w_j t) + \displaystyle\sum_{j=1}^{n/2} B_j cos(w_j t)\]</span></p>
<p>Para la ecuación anterior se usan los siguientes estimadores:</p>
<ul>
<li><p><span class="math inline">\(\hat{\mu}=\frac{1}{n} \displaystyle\sum_{t=1}^{T} y_t\)</span></p></li>
<li><p><span class="math inline">\(\hat{A}= \frac{2}{n} \displaystyle\sum_{t=1}^{n} sen(w_jt) y_t\)</span></p></li>
<li><p><span class="math inline">\(\hat{B}= \frac{2}{n} \displaystyle\sum_{t=1}^{n} cos(w_jt) y_t\)</span></p></li>
</ul>
<p>Un boxplot nos podría ayudar a ver cómo se comporta la serie por ciclos.</p>
</section>
<section id="en-resumen" class="level2" data-number="6.7">
<h2 data-number="6.7" class="anchored" data-anchor-id="en-resumen"><span class="header-section-number">6.7</span> En resumen…</h2>
<p>Finalizamos la discusión sobre el análisis descriptivo de una serie temporal. En general, deberíamos revisar:</p>
<ul>
<li><p>El gráfico de la serie.</p></li>
<li><p>Tendencia: si la hubiera, estimarla (modelo de tendencia deteminista, suavizado o tendencia evolutiva).</p></li>
<li><p>Estacionalidad: revisar el boxplot de la serie en función del ciclo y estimarla con los coeficientes estacionales (tal como lo hace R) o con funciones armónicas.</p></li>
<li><p>La predicción de la serie se realiza sumando las estimaciones de la tendencia y el factor estacional que corresponde a cada observación.</p>
<ul>
<li><p>En el caso de que estemos trabajando con el caso aditivo: <span class="math inline">\(y_t=\mu_t + S_t +a_t\)</span>.</p></li>
<li><p>En caso que el efecto estacional tienda a aumentar con la tendencia, usamos el caso multiplicativo: <span class="math inline">\(z_t=\mu_t \times S_t  \times a_t\)</span></p></li>
</ul></li>
</ul>
</section>
<section id="modelización-univariante-de-series-temporales" class="level2" data-number="6.8">
<h2 data-number="6.8" class="anchored" data-anchor-id="modelización-univariante-de-series-temporales"><span class="header-section-number">6.8</span> Modelización univariante de series temporales</h2>
<p>Ya hemos discutido cómo hacer el análisis descriptivo de una serie temporal para establecer si tiene tendencia, si es homocedástica o detectar con los gráficos de las funciones de autocorrelación (simple y parcial) si presenta estructura que depende del rezago de la serie.</p>
<p>Ahora, la idea es proponer modelos que introduzcan las correlaciones que se generan entre relaciones lineales rezagadas y que funcionan bien para <span style="color: ;"><em>series estacionarias</em></span>:blue}.</p>
<p>La representación formal de los procesos aleatorios que generan series reales se puede realizar mediante modelos lineales de series temporales. Para ello se considera la serie temporal ha sido generada por un proceso estocástico, en este parte vamos a describir los posibles modelos teóricos que permiten explicar el comportamiento de la misma y, por tanto, el de su proceso generador.</p>
<p>Las estructuras estocásticas estacionarias lineales que se tratarán de asociar a una serie de datos se clasifican en tres tipos:</p>
<ul>
<li><p><strong>Modelos autoregresivos (AR)</strong> ,</p></li>
<li><p><strong>Modelos de medias móviles (MA)</strong>,</p></li>
<li><p><strong>Modelos mixtos (ARMA)</strong></p></li>
</ul>
<p>Luego, los modelos mixtos se pueden extender a modelos para <span style="color: ;"><em>series no estacionarias</em></span>:blue}, popularizados por Box y Jenkins (1970), que conducen a los:</p>
<ul>
<li><strong>Modelos autorregresivos de media móvil integrados (ARIMA)</strong>,</li>
</ul>
<section id="procesos-autorregresivos-ar" class="level3" data-number="6.8.1">
<h3 data-number="6.8.1" class="anchored" data-anchor-id="procesos-autorregresivos-ar"><span class="header-section-number">6.8.1</span> Procesos autorregresivos (AR)</h3>
<p>Los procesos autorregresivos forman una familia de procesos tales que una observación depende de las observaciones anteriores. Se denominan procesos AR y se caracterizan por su orden.</p>
<p>Los modelos autorregresivos se basan en la idea de que el valor actual de la serie, <span class="math inline">\(y_t\)</span>, puede explicarse como una función de <span class="math inline">\(p\)</span> valores anteriores, <span class="math inline">\(y_{t-1}, y_{t-2},\ldots, y_{t-p}\)</span>, donde <span class="math inline">\(p\)</span> determina el número de pasos hacia el pasado necesarios para pronosticar el valor actual.</p>
<p>Por ejemplo, diremos que una serie <span class="math inline">\(y_t\)</span> sigue un <span style="color: ;"><em>proceso autoregresivo de primer orden, o un AR(1)</em></span>:blue} si ha sido generado por: <span class="math display">\[y_t=c+\phi y_{t-1}+a_t,\]</span> donde <span class="math inline">\(c\)</span> y <span class="math inline">\(-1&lt;\phi &lt; 1\)</span> son constantes a determinar y <span class="math inline">\(a_t\)</span> es un proceso de ruido blanco con varianza <span class="math inline">\(\sigma^2\)</span>.</p>
<p>La condición <span class="math inline">\(-1&lt;\phi &lt; 1\)</span> es necesaria para que el proceso sea estacionario. Veamos por qué…</p>
<p>Supongamos que la serie comienza con <span class="math inline">\(y_0=h\)</span>, siendo <span class="math inline">\(h\)</span> un valor cualquiera fijo. El siguiente valor será: <span class="math inline">\(y_1= c + \phi h + a_1\)</span>. Luego: <span class="math display">\[
\begin{aligned}
y_2&amp;= c + \phi y_1 + a_2 \\
    &amp;= c(1+\phi)+\phi^2 h + \phi a_1+a_2
\end{aligned}
\]</span></p>
<p><span class="math display">\[
\begin{aligned}
y_3&amp;= c + \phi y_2 + a_3 \\
    &amp;= c+\phi[c(1+\phi)+ \phi^2 h + \phi a_1+a_2]+a_3 \\
    &amp;=c(1+\phi+\phi^2)+\phi^3 h+\phi^2 a_1+\phi a_2+a_2
\end{aligned}
\]</span> <span class="math display">\[\vdots\]</span></p>
<p><span class="math display">\[y_t= c \sum_{i=0}^{t-1} \phi^i + \phi^t h+ \sum_{i=0}^{t-1} \phi^i a_{t-i}\]</span></p>
<p>Luego, como <span class="math inline">\(E[a_t]=0\)</span>, nos queda: <span class="math inline">\(E[y_t]=c \sum_{i=0}^{t-1} \phi^i + \phi^t h\)</span>. Entonces, si <span class="math inline">\(|\phi|&lt;1\)</span>, la serie geométrica <span class="math inline">\(\sum_{i=0}^{t-1} \phi^i\)</span> converge a <span class="math inline">\(\frac{1}{1-\phi}\)</span> y <span class="math inline">\(\phi^t\)</span> converge a cero.</p>
<p>Con esta condición, depués de un periodo transcurrido inicial, cuando <span class="math inline">\(t \rightarrow \infty\)</span>, todas las variables <span class="math inline">\(y_t\)</span> tendrán la misma esperanza, independientemente de las condiciones iniciales. <span class="math display">\[E[y_t]=\frac{c}{1-\phi}\]</span></p>
<p>Observemos también que en este proceso la innovación <span class="math inline">\(a_t\)</span> está incorrelada con los valores previos del proceso, <span class="math inline">\(y_{t-k}\)</span> para <span class="math inline">\(k\)</span> positivo. En efecto:</p>
<p>El valor <span class="math inline">\(y_{t-k}\)</span> depende de los valores de las innovaciones hasta ese instante, <span class="math inline">\(a_1, \ldots, a_{t-k}\)</span> pero no de sus valores futuros.</p>
<p>Como la innovación es un proceso de ruido blanco, sus valores futuros están incorrelados con los pasados y, por tanto, con los valores previos de proceso, <span class="math inline">\(y_{t-k}\)</span></p>
<p><strong>ACF y PACF del proceso AR(1)</strong></p>
<p>La función de autocorrelación simple y la parcial del proceso AR(1) tienen un aspecto muy característico.</p>
<p>Se puede demostrar que la ACF del proceso AR(1) tiene la expresión: <span class="math display">\[\rho_k=\phi^k,\]</span></p>
<p>es decir que la barra <span class="math inline">\(k\)</span>, de la ACF es igual al coeficiente <span class="math inline">\(\phi\)</span> elevado a la potencia <span class="math inline">\(k\)</span>. Esto implica que la ACF de un proceso AR(1) pueda tener el siguiente aspecto:</p>
<ul>
<li><p><span class="math inline">\(\phi\)</span> positivo: La ACF será una función positiva y decreciente.</p></li>
<li><p><span class="math inline">\(\phi\)</span> negativo: La ACf será una función alternada, y tendrá barras pares positivas, y barras impares negativas.</p></li>
</ul>
<p>En cuanto a la PACF, como indica la expresión AR(1), sólo existe influencia de primer orden, ya que si <span class="math inline">\(y_t\)</span> depende de <span class="math inline">\(y_{t-2}\)</span>, es a través de z_{t-1}. Las PACF será por tanto:</p>
<ul>
<li><p><span class="math inline">\(\phi\)</span> positivo: La PACF tendrá una única barra, la primera. Esta barra será positiva.</p></li>
<li><p><span class="math inline">\(\phi\)</span> negativo: La PACF tendrá una única barra y será negativa.</p></li>
</ul>
<p><span style="color: ;"><em>Ejemplos AR(1)</em></span>: blue;}</p>
<p>Vamos a simular dos AR(1), uno con <span class="math inline">\(\phi=0.8\)</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>AR<span class="ot">&lt;-</span><span class="fu">arima.sim</span>(<span class="fu">list</span>(<span class="at">order=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>),<span class="at">ar=</span><span class="sc">+</span>.<span class="dv">8</span>),<span class="at">n=</span><span class="dv">100</span>)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(AR,<span class="at">main=</span>(<span class="fu">expression</span>(<span class="fu">AR</span>(<span class="dv">1</span>)<span class="sc">~</span><span class="er">~~~</span>phi<span class="sc">==</span><span class="fl">0.8</span>)))</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="t6_series_temporales_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">acf</span>(AR,<span class="at">main=</span><span class="st">"autocorrelacion simple de orden 1"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="t6_series_temporales_files/figure-html/unnamed-chunk-22-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pacf</span>(AR,<span class="at">main=</span><span class="st">"autocorrelacion parcial"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="t6_series_temporales_files/figure-html/unnamed-chunk-22-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Simulamos un Ar(1) con <span class="math inline">\(\phi=-0.8\)</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>AR<span class="ot">&lt;-</span><span class="fu">arima.sim</span>(<span class="fu">list</span>(<span class="at">order=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>),<span class="at">ar=</span><span class="sc">-</span>.<span class="dv">8</span>),<span class="at">n=</span><span class="dv">100</span>)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(AR,<span class="at">main=</span>(<span class="fu">expression</span>(<span class="fu">AR</span>(<span class="dv">1</span>)<span class="sc">~</span><span class="er">~~~</span>phi<span class="sc">==-</span><span class="fl">0.8</span>)))</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="t6_series_temporales_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">acf</span>(AR,<span class="at">main=</span><span class="st">"autocorrelacion simple de orden 1"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="t6_series_temporales_files/figure-html/unnamed-chunk-23-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pacf</span>(AR,<span class="at">main=</span><span class="st">"autocorrelacion parcial"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="t6_series_temporales_files/figure-html/unnamed-chunk-23-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Operador de retardo</strong></p>
<p>El proceso AR(1) puede escribirse utilizando la notación de operador de retardo, <span class="math inline">\(B\)</span>, definido por: <span class="math display">\[By_t=y_{t-1},\]</span> El operador de retardo es:</p>
<ul>
<li><p>Lineal: <span class="math inline">\(\;\;\; Bay_{t}=aBy_t=ay_{t-1}\)</span></p></li>
<li><p>Puede aplicarse sucesivamente: <span class="math inline">\(\;\;\; B^ky_t=\underbrace{B \cdots B}_{k-veces}y_t=y_{t-k}\)</span></p></li>
</ul>
<p>Definiendo <span class="math inline">\(\tilde{y}_t= y_t-\mu\)</span>, como <span class="math inline">\(B \tilde{y}_t= \tilde{y}_{t-1}\)</span>, tenemos que: <span class="math display">\[(1-\phi B)\tilde{y}_t=a_t\]</span> Es decir, una serie centrada sigue un proceso AR(1) si al aplicarle el operador <span class="math inline">\((1-\phi B)\)</span> se obtiene un proceso de ruido blanco. Alternativamente, <span class="math inline">\(1-\phi B =0 \implies B=1/\phi\)</span>. La condición de estacionaridad es entonces que la raíz del operador sea, en valor absoluto, mayor que uno.</p>
<p>La condición de estacionaridad es que este factor sea menor que la unidad en valor absoluto.</p>
<p>Alternativamente, podemos hablar de la raíz de la ecuación del operador:<span class="math inline">\(1-\phi B =0 \implies B=1/\phi\)</span>. La condición de estacionaridad es entonces que la raíz del operador sea, en valor absoluto, mayor que uno.</p>
<p><strong>Características AR(1)</strong></p>
<p>En resumen, las características de un AR(1)</p>
<ul>
<li><span style="color: blue;"><em>Esperanza</em></span>:` Si <span class="math inline">\(|\phi|&lt;1\)</span>, entonces <span class="math inline">\(E(y_t)=\mu=\frac{c}{1-\phi}\)</span>. Usando que <span class="math inline">\(c=\mu (1-\phi)\)</span>, el proceso puede escribirse en desviaciones a su media <span class="math inline">\(y_t-\mu=\phi(y_{t-1}-\mu)+a_t,\)</span> y llamando <span class="math inline">\(\tilde{y}_t=y_t-\mu\)</span>, podemos escribir:</li>
</ul>
<p><span class="math display">\[\tilde{y}_t=\phi \tilde{y}_{t-1}+a_t\]</span></p>
<ul>
<li><p><span style="color: blue;"><em>Varianza</em></span>: se obtiene calculando <span class="math inline">\(E(\tilde{y}_t^2)\)</span>, de donde <span class="math inline">\(\sigma_y^2=\frac{\sigma^2}{1-\phi^2}\)</span></p></li>
<li><p><span style="color: blue;"><em>Autocovarianzas y correlación</em></span>: se puede demostrar que:</p>
<ul>
<li><p><span class="math inline">\(\gamma_k=\phi \gamma_{k-1}\)</span>, para <span class="math inline">\(k=1,2,\ldots\)</span>, donde <span class="math inline">\(\gamma_0=\sigma^2_y\)</span></p></li>
<li><p><span class="math inline">\(\rho_k=\phi^k\)</span></p></li>
</ul></li>
</ul>
</section>
<section id="arp" class="level3" data-number="6.8.2">
<h3 data-number="6.8.2" class="anchored" data-anchor-id="arp"><span class="header-section-number">6.8.2</span> AR(p)</h3>
<p>Diremos que una serie temporal <span class="math inline">\(y_t\)</span> estacionaria sigue un proceso autoregresivo de orden <span class="math inline">\(p\)</span> si: <span class="math display">\[\tilde{y}_t=\phi_1 \tilde{y}_{t-1}+ \cdots + \phi_p \tilde{y}_{t-p}+a_t,\]</span> donde <span class="math inline">\(\tilde{y}_t=y_t-\mu\)</span>, siendo <span class="math inline">\(\mu\)</span> la media del proceso <span class="math inline">\(y_t\)</span> y <span class="math inline">\(a_t\)</span> un proceso de ruido blanco.</p>
<p>Los parámetros se determinan a partir de las ecuaciones de Yule-Walker</p>
<p><span class="math display">\[\begin{matrix}
\rho_1 &amp; = &amp; \phi_1+\phi_2 \rho_1 + \cdots + \phi_p \rho_{p-1} \\
\rho_2 &amp; = &amp; \phi_1 \rho_1 + \phi_2 + \cdots + \phi_p \rho_{p-2} \\
&amp; \vdots &amp; \\
\rho_p &amp; = &amp; \phi_1 \rho_{p-1} + \phi_2 \rho_{p-2} + \cdots + \phi_p   
\end{matrix}\]</span></p>
<p>Definiendo: <span class="math display">\[\boldsymbol{\phi}' = [\phi_1, \ldots, \phi_p],\]</span> <span class="math display">\[\boldsymbol{\varrho}'=[\rho_1, \ldots, \rho_p],\]</span></p>
<p><span class="math display">\[R=\begin{bmatrix}
{1}&amp;{\rho_1}&amp; \cdots &amp; \rho_{p-1}\\
{\vdots}&amp;{\vdots} &amp; &amp; \vdots \\
\rho_{p-1}&amp; \rho_{p-2}&amp; \cdots &amp; 1
\end{bmatrix}\]</span> El sistema se escribe de manera matricialmente: <span class="math display">\[\boldsymbol{\varrho}=R \boldsymbol{\phi} \]</span> y los parámetros se determinan a partir de las autocorrelaciones mediante:</p>
<p><span class="math display">\[\boldsymbol{\phi}=R^{-1}\boldsymbol{\varrho}\]</span></p>
<p><span style="color: blue;"><em>Ejemplo AR(p) en R</em></span>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">7122021</span>)</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>x<span class="ot">&lt;-</span><span class="fu">rnorm</span>(<span class="dv">500</span>)</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>sim1<span class="ot">&lt;-</span><span class="fu">arima.sim</span>(<span class="fu">list</span>(<span class="at">ar=</span><span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.5</span>)),<span class="at">n=</span><span class="dv">500</span>,<span class="at">innov=</span>x)</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>sim2<span class="ot">&lt;-</span><span class="fu">arima.sim</span>(<span class="fu">list</span>(<span class="at">ar=</span><span class="fu">c</span>(.<span class="dv">5</span>,<span class="sc">-</span><span class="fl">0.5</span>)),<span class="at">n=</span><span class="dv">500</span>,<span class="at">innov=</span>x)</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>sim3<span class="ot">&lt;-</span><span class="fu">arima.sim</span>(<span class="fu">list</span>(<span class="at">ar=</span><span class="fu">c</span>(.<span class="dv">2</span>,<span class="sc">-</span>.<span class="dv">4</span>,.<span class="dv">6</span>)),<span class="at">n=</span><span class="dv">500</span>,<span class="at">innov=</span>x)</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>sim4<span class="ot">&lt;-</span><span class="fu">arima.sim</span>(<span class="fu">list</span>(<span class="at">ar=</span><span class="fu">c</span>(.<span class="dv">5</span>,.<span class="dv">4</span>,<span class="sc">-</span>.<span class="dv">6</span>,.<span class="dv">4</span>)),<span class="at">n=</span><span class="dv">500</span>,<span class="at">innov=</span>x)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="t6_series_temporales_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>));<span class="fu">acf</span>(sim1); <span class="fu">acf</span>(sim2); <span class="fu">acf</span>(sim3); <span class="fu">acf</span>(sim4)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="t6_series_temporales_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>));<span class="fu">pacf</span>(sim1); <span class="fu">pacf</span>(sim2); <span class="fu">pacf</span>(sim3); <span class="fu">pacf</span>(sim4)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="t6_series_temporales_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>¿De qué orden será este AR?</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="t6_series_temporales_files/figure-html/unnamed-chunk-28-1.png" class="lightbox" data-gallery="reto"><img src="t6_series_temporales_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="ejemplo-práctico" class="level3" data-number="6.8.3">
<h3 data-number="6.8.3" class="anchored" data-anchor-id="ejemplo-práctico"><span class="header-section-number">6.8.3</span> Ejemplo práctico</h3>
<p>Usaremos un conjunto de datos incorporado de R llamado <code>AirPassengers</code>. El conjunto de datos consta de el número total de pasajeros de aerolíneas internacionales, de 1949 a 1960 por meses.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"AirPassengers"</span>)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="fu">is.ts</span>(AirPassengers)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(AirPassengers)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec
1949 112 118 132 129 121 135 148 148 136 119 104 118
1950 115 126 141 135 125 149 170 170 158 133 114 140
1951 145 150 178 163 172 178 199 199 184 162 146 166
1952 171 180 193 181 183 218 230 242 209 191 172 194
1953 196 196 236 235 229 243 264 272 237 211 180 201
1954 204 188 235 227 234 264 302 293 259 229 203 229
1955 242 233 267 269 270 315 364 347 312 274 237 278
1956 284 277 317 313 318 374 413 405 355 306 271 306
1957 315 301 356 348 355 422 465 467 404 347 305 336
1958 340 318 362 348 363 435 491 505 404 359 310 337
1959 360 342 406 396 420 472 548 559 463 407 362 405
1960 417 391 419 461 472 535 622 606 508 461 390 432</code></pre>
</div>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(AirPassengers)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  104.0   180.0   265.5   280.3   360.5   622.0 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">start</span>(AirPassengers)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1949    1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">end</span>(AirPassengers)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1960   12</code></pre>
</div>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">time</span>(AirPassengers)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          Jan      Feb      Mar      Apr      May      Jun      Jul      Aug
1949 1949.000 1949.083 1949.167 1949.250 1949.333 1949.417 1949.500 1949.583
1950 1950.000 1950.083 1950.167 1950.250 1950.333 1950.417 1950.500 1950.583
1951 1951.000 1951.083 1951.167 1951.250 1951.333 1951.417 1951.500 1951.583
1952 1952.000 1952.083 1952.167 1952.250 1952.333 1952.417 1952.500 1952.583
1953 1953.000 1953.083 1953.167 1953.250 1953.333 1953.417 1953.500 1953.583
1954 1954.000 1954.083 1954.167 1954.250 1954.333 1954.417 1954.500 1954.583
1955 1955.000 1955.083 1955.167 1955.250 1955.333 1955.417 1955.500 1955.583
1956 1956.000 1956.083 1956.167 1956.250 1956.333 1956.417 1956.500 1956.583
1957 1957.000 1957.083 1957.167 1957.250 1957.333 1957.417 1957.500 1957.583
1958 1958.000 1958.083 1958.167 1958.250 1958.333 1958.417 1958.500 1958.583
1959 1959.000 1959.083 1959.167 1959.250 1959.333 1959.417 1959.500 1959.583
1960 1960.000 1960.083 1960.167 1960.250 1960.333 1960.417 1960.500 1960.583
          Sep      Oct      Nov      Dec
1949 1949.667 1949.750 1949.833 1949.917
1950 1950.667 1950.750 1950.833 1950.917
1951 1951.667 1951.750 1951.833 1951.917
1952 1952.667 1952.750 1952.833 1952.917
1953 1953.667 1953.750 1953.833 1953.917
1954 1954.667 1954.750 1954.833 1954.917
1955 1955.667 1955.750 1955.833 1955.917
1956 1956.667 1956.750 1956.833 1956.917
1957 1957.667 1957.750 1957.833 1957.917
1958 1958.667 1958.750 1958.833 1958.917
1959 1959.667 1959.750 1959.833 1959.917
1960 1960.667 1960.750 1960.833 1960.917</code></pre>
</div>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">frequency</span>(AirPassengers)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 12</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ts.plot</span>(AirPassengers, <span class="at">xlab=</span><span class="st">"Año"</span>, <span class="at">ylab=</span><span class="st">"Número de pasajeros"</span>, <span class="at">main=</span><span class="st">"Totales mensuales de pasajeros </span><span class="sc">\n</span><span class="st"> de aerolíneas internacionales, 1949-1960"</span>)</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Ajustamos una recta de regresión para la tendencia</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">reg=</span><span class="fu">lm</span>(AirPassengers<span class="sc">~</span><span class="fu">time</span>(AirPassengers)),<span class="at">col=</span><span class="st">"red"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="t6_series_temporales_files/figure-html/unnamed-chunk-30-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">acf</span>(AirPassengers)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="t6_series_temporales_files/figure-html/unnamed-chunk-30-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pacf</span>(AirPassengers)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="t6_series_temporales_files/figure-html/unnamed-chunk-30-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Vamos a ajustar un modelo AR</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>AR <span class="ot">&lt;-</span> <span class="fu">arima</span>(AirPassengers, <span class="at">order =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>))</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(AR)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
arima(x = AirPassengers, order = c(1, 0, 0))

Coefficients:
         ar1  intercept
      0.9646   278.4649
s.e.  0.0214    67.1141

sigma^2 estimated as 1119:  log likelihood = -711.09,  aic = 1428.18</code></pre>
</div>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Dibujamos la serie y los valores ajustados</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ts.plot</span>(AirPassengers)</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>AR_fit <span class="ot">&lt;-</span> AirPassengers <span class="sc">-</span> <span class="fu">residuals</span>(AR)</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(AR_fit, <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">col =</span> <span class="dv">2</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="t6_series_temporales_files/figure-html/unnamed-chunk-31-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(forecast)</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>AR <span class="sc">%&gt;%</span> <span class="fu">checkresiduals</span>(<span class="at">test =</span> F)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="t6_series_temporales_files/figure-html/unnamed-chunk-32-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Los residuos muestran que aún hay estructura por capturar, por tanto, si hacemos predicciones con este modelo:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Usamos predict() para hacer una predicción de un paso adelante</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>predict_AR <span class="ot">&lt;-</span> <span class="fu">predict</span>(AR)</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Obtenemos el valor de la predicción</span></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>predict_AR<span class="sc">$</span>pred[<span class="dv">1</span>]</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 426.5698</code></pre>
</div>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Si queremos más predicciones</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(AR, <span class="at">n.ahead =</span> <span class="dv">10</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$pred
          Jan      Feb      Mar      Apr      May      Jun      Jul      Aug
1961 426.5698 421.3316 416.2787 411.4045 406.7027 402.1672 397.7921 393.5717
          Sep      Oct
1961 389.5006 385.5735

$se
          Jan      Feb      Mar      Apr      May      Jun      Jul      Aug
1961 33.44577 46.47055 55.92922 63.47710 69.77093 75.15550 79.84042 83.96535
          Sep      Oct
1961 87.62943 90.90636</code></pre>
</div>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Dibujamos la serie y agregamos los pronósticos más los intervalos de predicción al 95%</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ts.plot</span>(AirPassengers, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">1949</span>, <span class="dv">1961</span>))</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>AR_forecast <span class="ot">&lt;-</span> <span class="fu">predict</span>(AR, <span class="at">n.ahead =</span> <span class="dv">10</span>)<span class="sc">$</span>pred</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>AR_forecast_se <span class="ot">&lt;-</span> <span class="fu">predict</span>(AR, <span class="at">n.ahead =</span> <span class="dv">10</span>)<span class="sc">$</span>se</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(AR_forecast, <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">col =</span> <span class="st">"red"</span>)</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(AR_forecast <span class="sc">-</span> <span class="dv">2</span><span class="sc">*</span>AR_forecast_se, <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">col =</span> <span class="st">"green"</span>, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">pch=</span><span class="dv">3</span>)</span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(AR_forecast <span class="sc">+</span> <span class="dv">2</span><span class="sc">*</span>AR_forecast_se, <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">col =</span> <span class="st">"green"</span>, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">pch=</span><span class="dv">3</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="t6_series_temporales_files/figure-html/unnamed-chunk-33-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Ajustamos un AR(2)</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>AR2<span class="ot">&lt;-</span><span class="fu">arima</span>(<span class="at">x=</span>AirPassengers,<span class="at">order=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">0</span>,<span class="dv">0</span>))</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(AR2)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
arima(x = AirPassengers, order = c(2, 0, 0))

Coefficients:
         ar1      ar2  intercept
      1.2831  -0.3322   280.4696
s.e.  0.0786   0.0792    49.4423

sigma^2 estimated as 995.9:  log likelihood = -702.82,  aic = 1413.64</code></pre>
</div>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>AR2 <span class="sc">%&gt;%</span> <span class="fu">checkresiduals</span>(<span class="at">test =</span> F)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="t6_series_temporales_files/figure-html/unnamed-chunk-34-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ts.plot</span>(AirPassengers, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">1949</span>, <span class="dv">1961</span>))</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>AR_forecast <span class="ot">&lt;-</span> <span class="fu">predict</span>(AR2, <span class="at">n.ahead =</span> <span class="dv">10</span>)<span class="sc">$</span>pred</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>AR_forecast_se <span class="ot">&lt;-</span> <span class="fu">predict</span>(AR2, <span class="at">n.ahead =</span> <span class="dv">10</span>)<span class="sc">$</span>se</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(AR_forecast, <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">col =</span> <span class="st">"red"</span>)</span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(AR_forecast <span class="sc">-</span> <span class="dv">2</span><span class="sc">*</span>AR_forecast_se, <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">col =</span> <span class="st">"green"</span>, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">pch=</span><span class="dv">3</span>)</span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(AR_forecast <span class="sc">+</span> <span class="dv">2</span><span class="sc">*</span>AR_forecast_se, <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">col =</span> <span class="st">"green"</span>, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">pch=</span><span class="dv">3</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="t6_series_temporales_files/figure-html/unnamed-chunk-34-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="modelos-de-media-móvil-ma" class="level3" data-number="6.8.4">
<h3 data-number="6.8.4" class="anchored" data-anchor-id="modelos-de-media-móvil-ma"><span class="header-section-number">6.8.4</span> Modelos de Media Móvil (MA)</h3>
<p>Los procesos de media móvil, MA, sirven para representan procesos de <strong>memoria muy corta</strong>. Son función de un número finito, y generalmente pequeño, de las innovaciones pasadas.</p>
<p>Por ejemplo, diremos que una serie <span class="math inline">\(y_t\)</span> sigue un <span style="color: blue;"><em>proceso de media móvil de primer orden, o un MA(1)</em></span> si ha sido generado por: <span class="math display">\[\tilde{y}_t=a_t - \theta a_{t-1},\]</span> donde <span class="math inline">\(\tilde{y}_t=y_t-\mu\)</span>, siendo <span class="math inline">\(\mu\)</span> la media del proceso y <span class="math inline">\(a_t\)</span> es un proceso de ruido blanco con varianza <span class="math inline">\(\sigma^2\)</span>.</p>
<p><span style="color: red;"><em>Observa que</em></span> MA como parte de los modelos que estamos estudiando se refiere a retardos de errores, mientras que en el análisis descriptivo, se refiere a una técnica de suavizado de datos.</p>
<p><strong>MA(1)</strong></p>
<p>El proceso MA(1) puede escribirse con la notación de operadores: <span class="math display">\[\tilde{z}_t=(1-\theta B)a_t\]</span></p>
<p>Este proceso es la suma de dos procesos estacionarios, y por tanto, siempre será estacionario. A pesar de lo anterior, en las aplicaciones de MA, supondremos que <span class="math inline">\(| \theta|&lt;1\)</span>, de manera que la innovación pasada tenga menos peso que la presente.</p>
<p><span style="color: blue;"><em>Propiedades teóricas del MA(1)</em></span> Se puede demostrar que:</p>
<ul>
<li><span class="math inline">\(E(y_t)=\mu\)</span>.</li>
<li><span class="math inline">\(Var(y_t)=\sigma_y^2 (1+\theta^2)\)</span>.</li>
<li><span class="math inline">\(\rho_1=\frac{\theta}{1+\theta^2},\)</span></li>
<li><span class="math inline">\(\rho_k=0\)</span> para <span class="math inline">\(k&gt;1\)</span>, por tanto, el ACF tendrá únicamente un valor distinto de cero en el primer retardo.</li>
</ul>
<p><strong>Ejemplo MA(1)</strong></p>
<p>Considera el siguiente proceso: <span class="math inline">\(y_t=10+0.7a_{t-1}+a_t,\)</span> donde <span class="math inline">\(a_t \mathop {\sim}\limits^{iid} N(0, 1)\)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>y_c<span class="ot">=</span><span class="fu">arima.sim</span>(<span class="at">n=</span><span class="dv">150</span>,<span class="fu">list</span>(<span class="at">ma=</span><span class="fl">0.7</span>))</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>y<span class="ot">=</span>y_c<span class="sc">+</span><span class="dv">10</span></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(y,<span class="at">type=</span><span class="st">"l"</span>,<span class="at">main=</span><span class="st">""</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="t6_series_temporales_files/figure-html/unnamed-chunk-35-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>De acuerdo a los resultados teóricos, <span class="math inline">\(\rho_1=\frac{0.7}{1+(0.7)^2}=0.4698\)</span> y <span class="math inline">\(\rho_k=0\)</span> para todo retardo mayor a 1.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a><span class="fu">acf</span>(y,<span class="at">lag.max =</span> <span class="dv">10</span>) <span class="co"># 10 retardos.</span></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a><span class="fu">pacf</span>(y,<span class="at">lag.max=</span><span class="dv">10</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="t6_series_temporales_files/figure-html/unnamed-chunk-36-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="proceso-maq" class="level3" data-number="6.8.5">
<h3 data-number="6.8.5" class="anchored" data-anchor-id="proceso-maq"><span class="header-section-number">6.8.5</span> Proceso MA(q)</h3>
<p>Podemos escribir procesos cuyo valor actual depende no sólo de la última innovación, sino de las <span class="math inline">\(q\)</span> últimas innovaciones: <span class="math display">\[\tilde{y}_t=a_t- \theta_1 a_{t-1}- \theta_2 a_{t-2} - \ldots - \theta_q a_{t-q}\]</span></p>
<p>En notación de retardos: <span class="math display">\[\tilde{y}_t=(1-\theta_1B-\theta_2B^2- \ldots \theta_qB^q) a_t\]</span></p>
<p><span style="color: blue;"><em>Propiedades del MA(q)</em></span>`</p>
<ul>
<li><p>En general, tiene autocorrelaciones diferentes de cero para los primeros <span class="math inline">\(q\)</span> retardos, es decir, lags &gt; <span class="math inline">\(q\)</span> tienen <span class="math inline">\(\rho=0\)</span>.</p></li>
<li><p><span class="math inline">\(\rho_k=\frac{\sum_{i=0}^q \theta_i \theta_{k+i}}{\sum_{i=0}^q \theta_i}\)</span>, para <span class="math inline">\(k=1,\ldots,q\)</span>. Además, <span class="math inline">\(\theta_0=-1\)</span>.</p></li>
</ul>
<p><span style="color: blue;"><em>Ejemplo MA(q) en R</em></span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>x<span class="ot">&lt;-</span><span class="fu">rnorm</span>(<span class="dv">500</span>)</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>sim1<span class="ot">&lt;-</span><span class="fu">arima.sim</span>(<span class="fu">list</span>(<span class="at">ma=</span><span class="fu">c</span>(<span class="dv">1</span>)),<span class="at">n=</span><span class="dv">500</span>,<span class="at">innov=</span>x)</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>sim2<span class="ot">&lt;-</span><span class="fu">arima.sim</span>(<span class="fu">list</span>(<span class="at">ma=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="sc">-</span><span class="dv">1</span>)),<span class="at">n=</span><span class="dv">500</span>,<span class="at">innov=</span>x)</span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>sim3<span class="ot">&lt;-</span><span class="fu">arima.sim</span>(<span class="fu">list</span>(<span class="at">ma=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>)),<span class="at">n=</span><span class="dv">500</span>,<span class="at">innov=</span>x)</span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>sim4<span class="ot">&lt;-</span><span class="fu">arima.sim</span>(<span class="fu">list</span>(<span class="at">ma=</span><span class="fu">c</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>,<span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>,<span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>,<span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>)),<span class="at">n=</span><span class="dv">500</span>,<span class="at">innov=</span>x)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="t6_series_temporales_files/figure-html/unnamed-chunk-38-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>));<span class="fu">acf</span>(sim1); <span class="fu">acf</span>(sim2); <span class="fu">acf</span>(sim3); <span class="fu">acf</span>(sim4)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="t6_series_temporales_files/figure-html/unnamed-chunk-39-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>));<span class="fu">pacf</span>(sim1); <span class="fu">pacf</span>(sim2); <span class="fu">pacf</span>(sim3); <span class="fu">pacf</span>(sim4)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="t6_series_temporales_files/figure-html/unnamed-chunk-40-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Para identificar si una serie se puede representar a través de un proceso <span class="math inline">\(MA(q)\)</span> podemos observar los gráficos de la función de autocorrelación simple (ACF) y la función de autocorrelación parcial (PACF).</p>
<ul>
<li><p>La ACF presentará <span style="color: blue;"><em>los primeros <span class="math inline">\(q\)</span> coeficientes no nulos</em></span>.</p></li>
<li><p>En la PACF, <span style="color: blue;"><em>muchos coeficientes serán no mulos</em></span>`. Presenta una mezcla de decrecimientos geométricos y sinusoidales hacia 0.</p></li>
</ul>
</section>
<section id="ajuste-de-un-ma-a-la-serie-airpassengers" class="level3" data-number="6.8.6">
<h3 data-number="6.8.6" class="anchored" data-anchor-id="ajuste-de-un-ma-a-la-serie-airpassengers"><span class="header-section-number">6.8.6</span> Ajuste de un MA a la serie <code>AirPassengers</code></h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>MA <span class="ot">&lt;-</span> <span class="fu">arima</span>(AirPassengers, <span class="at">order =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>))</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(MA)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
arima(x = AirPassengers, order = c(0, 0, 1))

Coefficients:
         ma1  intercept
      0.9642   280.6464
s.e.  0.0214    10.5788

sigma^2 estimated as 4205:  log likelihood = -806.43,  aic = 1618.86</code></pre>
</div>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Diujamos la serie y los valores ajustados del MA</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ts.plot</span>(AirPassengers)</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>MA_fit <span class="ot">&lt;-</span> AirPassengers <span class="sc">-</span> <span class="fu">resid</span>(MA)</span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(MA_fit, <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">col =</span> <span class="dv">2</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="t6_series_temporales_files/figure-html/unnamed-chunk-41-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Veamos qué tal sería la predicción</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Predicción un paso adelante</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>predict_MA <span class="ot">&lt;-</span> <span class="fu">predict</span>(MA)</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>predict_MA<span class="sc">$</span>pred[<span class="dv">1</span>]</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 425.1049</code></pre>
</div>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Predicción 10 pasos adelante</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(MA,<span class="at">n.ahead=</span><span class="dv">10</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$pred
          Jan      Feb      Mar      Apr      May      Jun      Jul      Aug
1961 425.1049 280.6464 280.6464 280.6464 280.6464 280.6464 280.6464 280.6464
          Sep      Oct
1961 280.6464 280.6464

$se
          Jan      Feb      Mar      Apr      May      Jun      Jul      Aug
1961 64.84895 90.08403 90.08403 90.08403 90.08403 90.08403 90.08403 90.08403
          Sep      Oct
1961 90.08403 90.08403</code></pre>
</div>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="do">##Dibujamos la serie y agregamos los pronósticos más los intervalos de predicción al 95%</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ts.plot</span>(AirPassengers, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">1949</span>, <span class="dv">1961</span>))</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>MA_forecasts <span class="ot">&lt;-</span> <span class="fu">predict</span>(MA, <span class="at">n.ahead =</span> <span class="dv">10</span>)<span class="sc">$</span>pred</span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>MA_forecast_se <span class="ot">&lt;-</span> <span class="fu">predict</span>(MA, <span class="at">n.ahead =</span> <span class="dv">10</span>)<span class="sc">$</span>se</span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(MA_forecasts, <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">col =</span> <span class="st">"red"</span>)</span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(MA_forecasts <span class="sc">-</span> <span class="dv">2</span><span class="sc">*</span>MA_forecast_se, <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">col =</span> <span class="st">"green"</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(MA_forecasts <span class="sc">+</span> <span class="dv">2</span><span class="sc">*</span>MA_forecast_se, <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">col =</span> <span class="st">"green"</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="t6_series_temporales_files/figure-html/unnamed-chunk-42-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="qué-es-mejor-para-modelizar-la-serie-de-airpassengers-un-ar-o-un-ma" class="level3" data-number="6.8.7">
<h3 data-number="6.8.7" class="anchored" data-anchor-id="qué-es-mejor-para-modelizar-la-serie-de-airpassengers-un-ar-o-un-ma"><span class="header-section-number">6.8.7</span> ¿Qué es mejor para modelizar la serie de <code>AirPassengers</code> un AR o un MA?</h3>
<p>Para responder esta pregunta podemos utilizar o bien el criterio de información de Akaike (<span class="math inline">\(AIC\)</span>) o el criterio de información bayesiano (<span class="math inline">\(BIC\)</span>).</p>
<p><span class="math display">\[AIC=-2 \, log(\hat{\sigma}^2_e)+2\,k\]</span></p>
<p><span class="math display">\[BIC=-2 \,log(\hat{\sigma}^2_e)+k \, log(n),\]</span> donde <span class="math inline">\(n\)</span> es el número de observaciones, <span class="math inline">\(k\)</span> es el número de parámetros, <span class="math inline">\(\hat{\sigma}^2_e\)</span> es el estimador de la varianza del error.</p>
<p>La fórmula del primer término de <span class="math inline">\(BIC\)</span> es la misma que la de <span class="math inline">\(AIC\)</span>, solo difiere en el segundo término. En el segundo término, se puede ver que el valor <span class="math inline">\(BIC\)</span> está influenciado por el tamaño de muestra y parámetros en el modelo.</p>
<p>La idea principal es que estos indicadores penalizan los modelos con el número de parámetros estimados, para evitar el sobreajuste, y se prefieren valores más pequeños. Si todos los factores son iguales, un modelo que produce un <span class="math inline">\(AIC\)</span> o <span class="math inline">\(BIC\)</span> más bajo que otro modelo se considera un mejor ajuste.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="fu">AIC</span>(AR)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1428.179</code></pre>
</div>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="fu">AIC</span>(MA)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1618.863</code></pre>
</div>
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="fu">BIC</span>(AR)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1437.089</code></pre>
</div>
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="fu">BIC</span>(MA)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1627.772</code></pre>
</div>
</div>
<p>Dado el valor más bajo de <span class="math inline">\(AIC\)</span> y <span class="math inline">\(BIC\)</span> en el modelo AR, deberíamos preferir a este que al MA para el análisis de series de tiempo de los datos de AirPassenger.</p>
</section>
</section>
<section id="armapq" class="level2" data-number="6.9">
<h2 data-number="6.9" class="anchored" data-anchor-id="armapq"><span class="header-section-number">6.9</span> ARMA(p,q)</h2>
<p>La ecuación para los procesos ARMA(p,q) es: <span class="math display">\[(1-\phi_1B-\ldots - \phi_pB^p)\tilde{y}_t=(1-\theta_1B- \ldots \theta_qB^q)a_t,\]</span> o en notación compacta: <span class="math display">\[\Phi_p(B)\tilde{y}_t=\Theta_q(B)a_t\]</span> La ACF y la PACF de los procesos ARMA es el resultado de la superposición de sus propiedades AR y MA. Por tanto, no es fácil identicar la estructura. Tanto la ACF como la PACF presentan muchos coeficientes no nulos. Sin embargo:</p>
<ul>
<li><p>En la ACF los coeficientes presentan decrecimiento hacia 0 desde <span class="math inline">\(q\)</span>.</p></li>
<li><p>En la PACF los coeficientes presentan decrecimiento hacia 0 desde <span class="math inline">\(p\)</span>.</p></li>
</ul>
<p><span style="color: blue;"><em>Ejemplo ARMA(p,q) en R</em></span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1012</span>)</span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>x<span class="ot">&lt;-</span><span class="fu">rnorm</span>(<span class="dv">200</span>)</span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>sim1<span class="ot">&lt;-</span><span class="fu">arima.sim</span>(<span class="fu">list</span>(<span class="at">ar=</span><span class="fu">c</span>(.<span class="dv">1</span>,.<span class="dv">5</span>,.<span class="dv">2</span>),<span class="at">ma=</span><span class="fu">c</span>(<span class="fl">0.6</span>,.<span class="dv">4</span>)),<span class="at">n=</span><span class="dv">200</span>,<span class="at">innov=</span>x)</span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a>sim2<span class="ot">&lt;-</span><span class="fu">arima.sim</span>(<span class="fu">list</span>(<span class="at">ar=</span><span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.4</span>),<span class="at">ma=</span><span class="fu">c</span>(<span class="fl">0.6</span>,.<span class="dv">1</span>)),<span class="at">n=</span><span class="dv">200</span>,<span class="at">innov=</span>x)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="t6_series_temporales_files/figure-html/unnamed-chunk-45-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>));<span class="fu">acf</span>(sim1); <span class="fu">pacf</span>(sim1); <span class="fu">acf</span>(sim2); <span class="fu">pacf</span>(sim2)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="t6_series_temporales_files/figure-html/unnamed-chunk-46-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>No resulta nada sencillo en la práctica identificar un proceso ARMA a través de sus acf y pacf, ya que es fácil confundir dichas funciones con las de otros procesos.</p>
<p>Se aconseja especificar y estimar inicialmente un modelo más sencillo, como por ejemplo un AR; posteriormente el análisis de los residuos obtenidos en dicha estimación pondrá de manifiesto la presencia de otras estructuras.</p>
<p>Si, por ejemplo, detectas en las funciones de autocorrelación simple y parcial de los residuos obtenidos una estructura de MA será necesario incorporar dicha estructura especificando un modelo ARMA, el cual sin duda tendrá una mayor capacidad explicativa.</p>
<p>¿Cómo harías esto en el ejemplo anterior?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ts.plot</span>(sim1)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="t6_series_temporales_files/figure-html/unnamed-chunk-47-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pacf</span>(sim1)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="t6_series_temporales_files/figure-html/unnamed-chunk-47-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>x<span class="ot">&lt;-</span><span class="fu">arima</span>(sim1, <span class="at">order=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">0</span>,<span class="dv">0</span>))</span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(x)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
arima(x = sim1, order = c(3, 0, 0))

Coefficients:
         ar1     ar2      ar3  intercept
      0.7661  0.3930  -0.2644    -0.2371
s.e.  0.0678  0.0833   0.0686     0.6617

sigma^2 estimated as 1.037:  log likelihood = -288.34,  aic = 586.69</code></pre>
</div>
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>y<span class="ot">&lt;-</span><span class="fu">residuals</span>(x)</span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ts.plot</span>(y)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="t6_series_temporales_files/figure-html/unnamed-chunk-47-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="fu">acf</span>(y)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="t6_series_temporales_files/figure-html/unnamed-chunk-47-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>y <span class="sc">%&gt;%</span> <span class="fu">checkresiduals</span>(<span class="at">test =</span> F)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="t6_series_temporales_files/figure-html/unnamed-chunk-47-5.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="procesos-integrados" class="level2" data-number="6.10">
<h2 data-number="6.10" class="anchored" data-anchor-id="procesos-integrados"><span class="header-section-number">6.10</span> Procesos Integrados</h2>
<p>Los procesos no estacionarios más frecuentes son los <strong>Procesos Integrados</strong>, que tienen la propiedad de que al diferenciarlos se obtienen procesos estacionarios.</p>
<p>Considera el proceso <span class="math display">\[w_t = \nabla y_t = y_t − y_{t−1}\]</span></p>
<p>Los valores de esta nueva serie oscilan alrededor de una media constante y parecen corresponder a una serie estacionaria. En este caso, diremos que la <strong>serie es integrada de orden 1</strong>.</p>
<p>Ahora, ajustamos un ARMA a <span class="math inline">\(w_t\)</span> y luego integramos: <span class="math display">\[y_t = w_t + y_{t−1}\]</span></p>
<p>A veces es necesario diferenciar más de 1 vez para obtener estacionaridad.</p>
<p><strong>Por ejemplo:</strong></p>
<p><span class="math inline">\(w_t = \nabla y_t\)</span> , no es estacionario. Entonces, <span class="math display">\[z_t = \nabla w_t = w_t − w_{t−1} = y_t − \nabla y_{t−1} + y_{t−2} = \nabla^2 y_t\]</span></p>
<p>Si <span class="math inline">\(z_t\)</span> es estacionario integramos dos veces para modelar a <span class="math inline">\(y_t\)</span> .</p>
<p><span style="color: blue;"><em>Proceso integrado de orden <span class="math inline">\(h\)</span></em></span>:</p>
<p>En general, diremos que un procesos es integrado de orden <span class="math inline">\(h\geq 0\)</span> y lo representamos por <span class="math inline">\(I(h)\)</span> cuando, al diferenciarlo <span class="math inline">\(h\)</span> veces se obtiene un proceso estacionario.</p>
<p>El modelo ARIMA(<span class="math inline">\(p\)</span>,<span class="math inline">\(d\)</span>,<span class="math inline">\(q\)</span>) puede ser considerado como el modelo estocástico lineal general, del cual derivan el resto de procesos que hemos visto.</p>
<p>Así, si <span class="math inline">\(p=d=0\)</span>, estaremos ante un modelo ARIMA(0, 0, <span class="math inline">\(q\)</span>) equivalente a un modelo MA(<span class="math inline">\(q\)</span>). Si <span class="math inline">\(q=0\)</span> tendríamos un modelo ARIMA(<span class="math inline">\(p\)</span>, <span class="math inline">\(d\)</span>, <span class="math inline">\(0\)</span>) ó ARI(<span class="math inline">\(p\)</span>,<span class="math inline">\(d\)</span>) (es decir, un modelo autorregresivo en el que se han tomado <span class="math inline">\(d\)</span> diferencias para hacer estacionaria a la serie analizada).</p>
<section id="ejemplo-demostrativo-con-r" class="level3" data-number="6.10.1">
<h3 data-number="6.10.1" class="anchored" data-anchor-id="ejemplo-demostrativo-con-r"><span class="header-section-number">6.10.1</span> Ejemplo demostrativo con R</h3>
<p>Vamos a trabajar de nuevo con datos simulados.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">250</span>)</span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>ts<span class="ot">=</span><span class="fu">arima.sim</span>(<span class="fu">list</span>(<span class="at">order =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">2</span>), </span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ma=</span><span class="fu">c</span>(<span class="fl">0.32</span>,<span class="fl">0.47</span>), </span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ar=</span><span class="fl">0.8</span>), <span class="at">n =</span> <span class="dv">50</span>)<span class="sc">+</span><span class="dv">20</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>A continuación, dibujamos la serie temporal original y sus acf y pacf.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">3</span>), <span class="at">ncol =</span> <span class="dv">2</span>)</span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>nf <span class="ot">&lt;-</span> <span class="fu">layout</span>(m)</span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot.ts</span>(ts)</span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a><span class="fu">acf</span>(ts)</span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a><span class="fu">pacf</span>(ts)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="t6_series_temporales_files/figure-html/unnamed-chunk-49-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>La serie original muestra una clara no estacionariedad; el acf muestra una disminución lenta y el pacf indica un AR de orden uno.</p>
<p>Vamos a diferenciar la serie para ver si logramos eliminar la tencia.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>y<span class="ot">=</span><span class="fu">diff</span>(ts)</span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(y)</span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a><span class="fu">acf</span>(y)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="t6_series_temporales_files/figure-html/unnamed-chunk-50-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Los datos de la primera diferencia parecen estacionarios. El ACF se corta después de algunos rezagos.</p>
<p>Dado que se necesitó una diferenciación para obtener la estacionariedad, aquí <span class="math inline">\(d\)</span> = 1</p>
<p>El siguiente paso es proponer los valores de <span class="math inline">\(p\)</span>, el orden de la parte AR. Vemos que el PACF de la serie original se corta en uno y el ACF de la serie diferenciada se corta después del rezago 2. Así que proponemos tres modelos para los datos diferenciados:</p>
<ul>
<li><p>ARIMA(1,1,0)</p></li>
<li><p>ARIMA(0,1,2)</p></li>
<li><p>ARIMA(1,1,2)</p></li>
</ul>
<p>Ajustamos los tres modelos ARIMA con las primeras 40 observaciones y dejamos las últimas 10 para pronosticar</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Partición en training y test</span></span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>train<span class="ot">=</span>ts[<span class="dv">1</span><span class="sc">:</span><span class="dv">40</span>]</span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a>test<span class="ot">=</span>ts[<span class="dv">41</span><span class="sc">:</span><span class="dv">50</span>]</span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a><span class="do">## ajustamos los modelos</span></span>
<span id="cb98-6"><a href="#cb98-6" aria-hidden="true" tabindex="-1"></a>arimaModel_1<span class="ot">=</span><span class="fu">arima</span>(train, <span class="at">order=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>))</span>
<span id="cb98-7"><a href="#cb98-7" aria-hidden="true" tabindex="-1"></a>arimaModel_2<span class="ot">=</span><span class="fu">arima</span>(train, <span class="at">order=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb98-8"><a href="#cb98-8" aria-hidden="true" tabindex="-1"></a>arimaModel_3<span class="ot">=</span><span class="fu">arima</span>(train, <span class="at">order=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb98-9"><a href="#cb98-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-10"><a href="#cb98-10" aria-hidden="true" tabindex="-1"></a><span class="do">## revisamos los parámetros ajustados</span></span>
<span id="cb98-11"><a href="#cb98-11" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(arimaModel_1);<span class="fu">print</span>(arimaModel_2);<span class="fu">print</span>(arimaModel_3)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
arima(x = train, order = c(1, 1, 0))

Coefficients:
         ar1
      0.8012
s.e.  0.0892

sigma^2 estimated as 1.311:  log likelihood = -61.13,  aic = 126.26</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
arima(x = train, order = c(0, 1, 2))

Coefficients:
         ma1    ma2
      0.7408  1.000
s.e.  0.2135  0.537

sigma^2 estimated as 0.9673:  log likelihood = -57.78,  aic = 121.57</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
arima(x = train, order = c(1, 1, 2))

Coefficients:
         ar1     ma1     ma2
      0.5585  0.4438  0.7238
s.e.  0.1581  0.1584  0.1305

sigma^2 estimated as 0.8554:  log likelihood = -53.64,  aic = 115.29</code></pre>
</div>
</div>
<p>Observa que el signo de los coeficientes estimados por R es consistente con la fórmula de la simulación del ARIMA. Observa las varianzas de los términos de error de cada modelo y el AIC, de acuerdo a estos, el mejor modelo es el 3.</p>
<p>Veamos las predicciones sobre las observaciones que no hemos utilizado para ajustar los parámetros</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Modelo 1</span></span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ts.plot</span>(ts)</span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a>forecast1<span class="ot">=</span><span class="fu">predict</span>(arimaModel_1, <span class="dv">10</span>)<span class="sc">$</span>pred</span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a>forecast1_se<span class="ot">=</span><span class="fu">predict</span>(arimaModel_1, <span class="dv">10</span>)<span class="sc">$</span>se</span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(forecast1, <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">col =</span> <span class="st">"red"</span>)</span>
<span id="cb102-6"><a href="#cb102-6" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(forecast1 <span class="sc">-</span> <span class="dv">2</span><span class="sc">*</span>forecast1_se, <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">col =</span> <span class="st">"green"</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb102-7"><a href="#cb102-7" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(forecast1 <span class="sc">+</span> <span class="dv">2</span><span class="sc">*</span>forecast1_se, <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">col =</span> <span class="st">"green"</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="t6_series_temporales_files/figure-html/unnamed-chunk-52-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Modelo 2</span></span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ts.plot</span>(ts)</span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a>forecast2<span class="ot">=</span><span class="fu">predict</span>(arimaModel_2, <span class="dv">10</span>)<span class="sc">$</span>pred</span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a>forecast2_se<span class="ot">=</span><span class="fu">predict</span>(arimaModel_2, <span class="dv">10</span>)<span class="sc">$</span>se</span>
<span id="cb103-5"><a href="#cb103-5" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(forecast2, <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">col =</span> <span class="st">"red"</span>)</span>
<span id="cb103-6"><a href="#cb103-6" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(forecast2 <span class="sc">-</span> <span class="dv">2</span><span class="sc">*</span>forecast2_se, <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">col =</span> <span class="st">"green"</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb103-7"><a href="#cb103-7" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(forecast2 <span class="sc">+</span> <span class="dv">2</span><span class="sc">*</span>forecast2_se, <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">col =</span> <span class="st">"green"</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="t6_series_temporales_files/figure-html/unnamed-chunk-52-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Modelo 3</span></span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ts.plot</span>(ts)</span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a>forecast3<span class="ot">=</span><span class="fu">predict</span>(arimaModel_3, <span class="dv">10</span>)<span class="sc">$</span>pred</span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a>forecast3_se<span class="ot">=</span><span class="fu">predict</span>(arimaModel_3, <span class="dv">10</span>)<span class="sc">$</span>se</span>
<span id="cb104-5"><a href="#cb104-5" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(forecast3, <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">col =</span> <span class="st">"red"</span>)</span>
<span id="cb104-6"><a href="#cb104-6" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(forecast3 <span class="sc">-</span> <span class="dv">2</span><span class="sc">*</span>forecast3_se, <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">col =</span> <span class="st">"green"</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb104-7"><a href="#cb104-7" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(forecast3 <span class="sc">+</span> <span class="dv">2</span><span class="sc">*</span>forecast3_se, <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">col =</span> <span class="st">"green"</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="t6_series_temporales_files/figure-html/unnamed-chunk-52-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Vemos que el segundo modelo tiene una ejecución similar al tres, a pesar de no tener el mejor valor de probabilidad de AIC. Por tanto, necesitamos medidas de la precisión de las estimaciones:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="fu">accuracy</span>(forecast2, test)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              ME     RMSE     MAE      MPE     MAPE
Test set 4.97575 7.150113 4.97575 14.39955 14.39955</code></pre>
</div>
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="fu">accuracy</span>(forecast3, test)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              ME     RMSE     MAE      MPE     MAPE
Test set 5.38043 7.474219 5.38043 15.73739 15.73739</code></pre>
</div>
</div>
<p>Donde cada medida es:</p>
<ul>
<li><p>ME error medio</p></li>
<li><p>RMSE error cuadrático medio</p></li>
<li><p>MAE error absoluto medio</p></li>
<li><p>MPE error porcentual medio</p></li>
<li><p>MAPE error porcentual absoluto medio</p></li>
</ul>
<p>Depende de cada caso decidir, basándose en las medidas de precisión, si considera que el modelo es adecuado o no. Por ejemplo, el error porcentual medio de 14,4% no me parece grande, pero eso puede depender de cuáles son las series y cuánta previsibilidad podemos esperar de manera realista.</p>
<p>Pero cuidado! nos falta revisar los residuos !!!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a>arimaModel_2 <span class="sc">%&gt;%</span> <span class="fu">checkresiduals</span>(<span class="at">test =</span> F)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="t6_series_temporales_files/figure-html/unnamed-chunk-54-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a>arimaModel_3 <span class="sc">%&gt;%</span> <span class="fu">checkresiduals</span>(<span class="at">test =</span> F)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="t6_series_temporales_files/figure-html/unnamed-chunk-54-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Conclusión: Mejor es el modelo 3, tal como lo habíamos simulado ;-)</p>
</section>
<section id="ejemplo-con-datos-reales" class="level3" data-number="6.10.2">
<h3 data-number="6.10.2" class="anchored" data-anchor-id="ejemplo-con-datos-reales"><span class="header-section-number">6.10.2</span> Ejemplo con datos reales</h3>
<p>Vamos a analizar un fichero de datos que contiene la edad en que murieron los reyes sucesivos de Inglaterra comenzando con William el conquistador, en total son 42 reyes.</p>
<p>Según otra fuente consultada, <a href="https://en.wikipedia.org/wiki/List_of_British_monarchs_by_longevity">wikipedia</a>, William fue el sexto rey y murió en 1837 a los 71 años, sin embargo, el fichero indica 60 años.</p>
<p>Los datos se obtuvieron de un fichero publicado en el artículo “Interactive Data Anlaysis: A Practical Primer” de Don McNeil, publicado el 4 de mayo de 1977.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a>edad_muerte<span class="ot">=</span><span class="fu">ts</span>(kings)</span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a>edad_muerte</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Time Series:
Start = 1 
End = 42 
Frequency = 1 
 [1] 60 43 67 50 56 42 50 65 68 43 65 34 47 34 49 41 13 35 53 56 16 43 69 59 48
[26] 59 86 55 68 51 33 49 67 77 81 67 71 81 68 70 77 56</code></pre>
</div>
</div>
<p>¿La serie es estacionaria?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot.ts</span>(edad_muerte, <span class="at">xlab=</span> <span class="st">"Dinastía"</span>, </span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab=</span><span class="st">"Edad muerte del Rey"</span>,</span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span><span class="st">"Longevidad de los Reyes Británicos </span></span>
<span id="cb113-4"><a href="#cb113-4" aria-hidden="true" tabindex="-1"></a><span class="st">     según la dinastía"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="t6_series_temporales_files/figure-html/unnamed-chunk-57-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Vamos a diferenciar la serie:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a>diff_o1 <span class="ot">&lt;-</span> <span class="fu">diff</span>(edad_muerte, <span class="at">differences=</span><span class="dv">1</span>)</span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot.ts</span>(diff_o1)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="t6_series_temporales_files/figure-html/unnamed-chunk-58-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>La serie temporal de las primeras diferencias parece ser estacionaria en la media y la varianza, por lo que un modelo ARIMA(<span class="math inline">\(p\)</span>,1,<span class="math inline">\(q\)</span>) es probablemente apropiado para la serie temporal de la edad de la muerte de los reyes de Inglaterra.</p>
<p>Al tomar las series de tiempo de las primeras diferencias, hemos eliminado el componente de tendencia y nos quedamos con un componente irregular.</p>
<p>Ahora podemos examinar si hay correlaciones entre los términos sucesivos de este componente irregular. Si es así, esto podría ayudarnos a hacer un modelo predictivo para las edades de la muerte de los reyes.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a><span class="fu">acf</span>(diff_o1, <span class="at">lag.max =</span> <span class="dv">20</span>) <span class="co"># si especificamos plot=FALSE podemos obtener los valores</span></span>
<span id="cb115-3"><a href="#cb115-3" aria-hidden="true" tabindex="-1"></a><span class="fu">pacf</span>(diff_o1, <span class="at">lag.max =</span> <span class="dv">20</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="t6_series_temporales_files/figure-html/unnamed-chunk-59-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Los modelos posibles son:</p>
<ul>
<li><p>ARMA(3,0) es decir, un modelo autorregresivo de orden <span class="math inline">\(p = 3\)</span>, ya que el autocorrelograma parcial es cero después del retraso 3, y el autocorrelograma se reduce a cero (aunque quizás muy bruscamente para que este modelo sea apropiado).</p></li>
<li><p>ARMA(0,1) un modelo de media móvil de orden <span class="math inline">\(q = 1\)</span>, ya que el autocorrelograma es cero después del desfase 1 y el autocorrelograma parcial se reduce a cero.</p></li>
<li><p>ARMA(p,q) un modelo mixto con <span class="math inline">\(p\)</span> y <span class="math inline">\(q\)</span> mayores que 0, ya que el autocorrelograma y el correlograma parcial se reducen a cero (aunque el correlograma probablemente se reduce a cero abruptamente para que este modelo sea apropiado)</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a>modelo1 <span class="ot">=</span> <span class="fu">arima</span>(diff_o1, <span class="at">order=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">0</span>,<span class="dv">0</span>))</span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a>modelo2 <span class="ot">=</span> <span class="fu">arima</span>(diff_o1, <span class="at">order=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>))</span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a>modelo3 <span class="ot">=</span> <span class="fu">arima</span>(diff_o1, <span class="at">order=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">0</span>,<span class="dv">1</span>))</span>
<span id="cb116-4"><a href="#cb116-4" aria-hidden="true" tabindex="-1"></a><span class="fu">AIC</span>(modelo1,modelo2,modelo3)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        df      AIC
modelo1  5 348.5243
modelo2  3 345.8136
modelo3  6 350.5172</code></pre>
</div>
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="fu">BIC</span>(modelo1,modelo2,modelo3)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        df      BIC
modelo1  5 357.0922
modelo2  3 350.9543
modelo3  6 360.7987</code></pre>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(modelo2<span class="sc">$</span>residuals)</span>
<span id="cb120-3"><a href="#cb120-3" aria-hidden="true" tabindex="-1"></a><span class="fu">qqnorm</span>(modelo2<span class="sc">$</span>residuals)</span>
<span id="cb120-4"><a href="#cb120-4" aria-hidden="true" tabindex="-1"></a><span class="fu">qqline</span>(modelo2<span class="sc">$</span>residuals,<span class="at">col=</span><span class="st">"red"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="t6_series_temporales_files/figure-html/unnamed-chunk-61-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="t6_series_temporales_files/figure-html/unnamed-chunk-62-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a>modelo2<span class="sc">$</span>coef</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       ma1  intercept 
-0.7462804  0.3881635 </code></pre>
</div>
</div>
<p>Un modelo de MA (promedio móvil) se usa generalmente para modelar una serie de tiempo que muestra dependencias a corto plazo entre observaciones sucesivas.</p>
<p>De manera intuitiva, tiene sentido que se pueda usar un modelo de MA para describir el componente irregular en las series de tiempo de la muerte de los reyes ingleses, ya que podríamos esperar que la edad de un rey inglés en particular tenga algún efecto en las edades de muerte del próximo rey o dos, pero no mucho efecto en las edades en la muerte de los reyes que reinarán mucho más tiempo después de eso.</p>
<p>Dado que un modelo ARMA(0,1) (con <span class="math inline">\(p = 0\)</span>, <span class="math inline">\(q = 1\)</span>) se considera el mejor modelo candidato para la serie temporal de las primeras diferencias de las edades de muerte de los reyes ingleses, la serie temporal original del las edades de muerte se pueden modelar con un <strong>ARIMA(0,1,1)</strong>.</p>
<p>Vamos a usar a función <code>auto.arima()</code> de la librería <code>forecast</code> para confirmar nuestra selección.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(forecast)</span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a><span class="fu">auto.arima</span>(edad_muerte)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Series: edad_muerte 
ARIMA(0,1,1) 

Coefficients:
          ma1
      -0.7218
s.e.   0.1208

sigma^2 = 236.2:  log likelihood = -170.06
AIC=344.13   AICc=344.44   BIC=347.56</code></pre>
</div>
</div>
<p>Podemos usar el modelo ARIMA para hacer pronósticos de valores futuros de la serie de tiempo, usando la función <code>forecast.Arima()</code> del paquete <code>forecast</code>.</p>
<p>Por ejemplo, para pronosticar las edades al morir de los próximos cinco reyes ingleses, escribimos:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a>pronostico<span class="ot">=</span><span class="fu">forecast</span>(<span class="fu">arima</span>(edad_muerte, <span class="at">order=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>)), <span class="at">h=</span><span class="dv">5</span>)</span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a>pronostico</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Point Forecast    Lo 80    Hi 80    Lo 95     Hi 95
43       67.75063 48.29647 87.20479 37.99806  97.50319
44       67.75063 47.55748 87.94377 36.86788  98.63338
45       67.75063 46.84460 88.65665 35.77762  99.72363
46       67.75063 46.15524 89.34601 34.72333 100.77792
47       67.75063 45.48722 90.01404 33.70168 101.79958</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(pronostico)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="t6_series_temporales_files/figure-html/unnamed-chunk-66-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="ljung-box-test" class="level3" data-number="6.10.3">
<h3 data-number="6.10.3" class="anchored" data-anchor-id="ljung-box-test"><span class="header-section-number">6.10.3</span> Ljung Box test</h3>
<p>El test Ljung Box se utiliza para contrastar la ausencia de autocorrelación en una serie, hasta un retardo específico <span class="math inline">\(k\)</span>.</p>
<p>El test determina si los errores, luego de ajustar el modelo son independientes e idénticamente distribuidos (ruido blanco) o si existe alguna estructura más en ellos. En otras palabras, si las autocorrelaciones de los errores no son cero.</p>
<p>Un <span class="math inline">\(p\)</span>-valor significativo (&lt; 0.05) indica rechazar la hipótesis nula, es decir la serie presenta autocorrelación.</p>
<p>El estadístico del test para una serie de longitud <span class="math inline">\(n\)</span> es: <span class="math display">\[Q(m)=n(n+2)\sum_{j=1}^{m} \frac{r_j^2}{n-j},\]</span> donde:</p>
<ul>
<li><p><span class="math inline">\(r_j\)</span> son las autocorrelaciones muestrales</p></li>
<li><p><span class="math inline">\(m\)</span> es el tiempo de retardo.</p></li>
</ul>
<p>Rechazamos <span class="math inline">\(H_0\)</span> si <span class="math inline">\(Q &gt; \chi_{1-\alpha,\nu}^2\)</span>, donde:</p>
<ul>
<li><span class="math inline">\(\chi_{1-\alpha,\nu}^2\)</span> es el cuantil de la distribución ji-cuadrado para el nivel de significancia <span class="math inline">\(\alpha\)</span> y <span class="math inline">\(\nu\)</span> los grados de libertad.</li>
</ul>
<p>Cuando se aplica el test Ljung Box a los residuos de un modelo ARIMA, los grados de libertad <span class="math inline">\(\nu\)</span> son <span class="math inline">\(m-p-q\)</span>, donde <span class="math inline">\(p\)</span> y <span class="math inline">\(q\)</span> son los parámetros del ARIMA(p,q) model. En <code>R</code> el test está implementaddo en la función <code>Box.test</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Box.test</span>(<span class="fu">residuals</span>(modelo2),<span class="at">lag=</span><span class="dv">2</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Box-Pierce test

data:  residuals(modelo2)
X-squared = 0.83577, df = 2, p-value = 0.6584</code></pre>
</div>
</div>
</section>
<section id="procesos-estacionales-sarimas" class="level3" data-number="6.10.4">
<h3 data-number="6.10.4" class="anchored" data-anchor-id="procesos-estacionales-sarimas"><span class="header-section-number">6.10.4</span> Procesos estacionales: SARIMAs</h3>
<p>Otra causa de no estacionaridad es la estacionalidad.</p>
<p>Por ejemplo, en una serie mensual con estacionalidad anual, cada mes tiene una media distinta, con lo cual la media no es estable.</p>
<p>En muchos casos, un proceso estacional se convierte en estacionario al tomar un número <span class="math inline">\(D\)</span> de diferencias estacionales.</p>
<p>Para detectar un comportamiento estacional podemos analizar las ACF y PACF de la serie.</p>
<p>Si al representar dichas funciones se aprecian valores muy altos, significativamente distintos de cero, para los retardos estacionales podremos concluir que la serie presenta un componente estacional y debemos exigir que el componente estacional se mantenga constante a lo largo del tiempo.</p>
<p>Así, si observamos que la ACF presenta un lento decaimiento en los valores correspondientes a los retardos estacionales y el valor del primer retardo estacional es próximo a uno tanto en ACF como PACF, es muy probable que el comportamiento estacional de la serie no presente un carácter estacionario, por lo que será necesario tomar diferencias de tipo estacional.</p>
<p>Los ARIMAs estacionales tienen las siguientes características:</p>
<ul>
<li><p>Contienen una componente ARIMA(<span class="math inline">\(P\)</span>,<span class="math inline">\(D\)</span>,<span class="math inline">\(Q\)</span>) que modeliza la dependencia estacional.</p></li>
<li><p>Contienen otra componente ARIMA(<span class="math inline">\(p\)</span>,<span class="math inline">\(d\)</span>,<span class="math inline">\(q\)</span>) que modeliza la dependencia regular, que es la dependencia asociada a observaciones consecutivas.</p></li>
<li><p>El proceso diferenciado <span class="math inline">\(w_t=\nabla^D \nabla^d y_t\)</span> es un proceso estacionario que sigue el modelo ARMA estacional.</p></li>
</ul>
<p>Este proceso se denota como</p>
<p><span class="math display">\[\textbf{ARIMA}\quad\underbrace{(p,d,q)}_{parte \,\, regular} \times \underbrace{(P,D,Q,)}_{parte \,\,estacional}\]</span></p>
<p><span style="color: blue;"><em>Ejemplo de ajuste de un SARIMA</em></span></p>
<p>Consideremos los datos del fichero <code>papel</code> que corresponden a las ventas mensuales de papel correspondiente a 10 años.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a>papel<span class="ot">=</span><span class="fu">scan</span>(<span class="st">"datos/papel.txt"</span>)</span>
<span id="cb130-2"><a href="#cb130-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(papel,<span class="at">ylab=</span><span class="st">'Venta papel'</span>,<span class="at">xlab=</span><span class="st">'Tiempo'</span>,<span class="at">type=</span><span class="st">'o'</span>,<span class="at">pch=</span><span class="dv">16</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="t6_series_temporales_files/figure-html/unnamed-chunk-68-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a>dpapel <span class="ot">=</span> <span class="fu">diff</span>(papel,<span class="dv">1</span>)</span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">1</span>))</span>
<span id="cb131-3"><a href="#cb131-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(dpapel,<span class="at">ylab=</span><span class="st">'Valores'</span>,<span class="at">xlab=</span><span class="st">'Tiempo'</span>,<span class="at">type=</span><span class="st">'l'</span>,<span class="at">pch=</span><span class="dv">16</span>,<span class="at">main=</span><span class="st">"Serie sin tendencia"</span>)</span>
<span id="cb131-4"><a href="#cb131-4" aria-hidden="true" tabindex="-1"></a><span class="fu">acf</span>(dpapel,<span class="dv">60</span>,<span class="at">main=</span><span class="st">""</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="t6_series_temporales_files/figure-html/unnamed-chunk-69-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb132"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">1</span>))</span>
<span id="cb132-2"><a href="#cb132-2" aria-hidden="true" tabindex="-1"></a>d12dpapel <span class="ot">=</span> <span class="fu">diff</span>(dpapel,<span class="dv">12</span>)</span>
<span id="cb132-3"><a href="#cb132-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(d12dpapel,<span class="at">ylab=</span><span class="st">'Serie'</span>,<span class="at">xlab=</span><span class="st">'Tiempo'</span>,<span class="at">type=</span><span class="st">'l'</span>,<span class="at">pch=</span><span class="dv">16</span>,</span>
<span id="cb132-4"><a href="#cb132-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span><span class="st">"Serie sin tendencia y desestacionalizada"</span>)</span>
<span id="cb132-5"><a href="#cb132-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-6"><a href="#cb132-6" aria-hidden="true" tabindex="-1"></a><span class="fu">acf</span>(d12dpapel,<span class="dv">60</span>,<span class="at">main=</span><span class="st">"Ventas de papel desestacionalizada y diferenciada"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="t6_series_temporales_files/figure-html/unnamed-chunk-70-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pacf</span>(d12dpapel,<span class="dv">60</span>,<span class="at">main=</span><span class="st">""</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="t6_series_temporales_files/figure-html/unnamed-chunk-70-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>La PACF muestra decaimiento exponencial mientras que el acf muestra un pico bastante significativo y aislado en el retardo 1, entonces debe tratarse de un MA(1). Además de este pico, sigue apareciendo en el retardo 12 de ambas autocorrelaciones, aún hay un remanente de estacionalidad, lo que sugiere agregar un MA(1) estacional.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a>a<span class="ot">=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>)</span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a>(<span class="at">modelo=</span><span class="fu">arima</span>(papel,a,<span class="at">seasonal=</span><span class="fu">list</span>(<span class="at">order=</span>a,<span class="at">period=</span><span class="dv">12</span>)))</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
arima(x = papel, order = a, seasonal = list(order = a, period = 12))

Coefficients:
          ma1     sma1
      -0.8402  -0.6360
s.e.   0.0611   0.0929

sigma^2 estimated as 1809:  log likelihood = -556.91,  aic = 1119.83</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb136"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a>pronostico<span class="ot">=</span><span class="fu">forecast</span>(modelo, <span class="at">h=</span><span class="dv">20</span>)</span>
<span id="cb136-2"><a href="#cb136-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(pronostico)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="t6_series_temporales_files/figure-html/unnamed-chunk-72-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tsdiag</span>(modelo)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="t6_series_temporales_files/figure-html/unnamed-chunk-73-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list" style="display: none">
<div id="ref-cryer" class="csl-entry" role="listitem">
Jonathan D. Cryer, Kung-Sik Chan. 2008. <em>Time Series Analysis With Applications in R</em>. Editado por Springer. 2º ed.
</div>
<div id="ref-pena" class="csl-entry" role="listitem">
Peña, Daniel. 2010. <em>Análisis de Series Temporales</em>. Editado por Alianza Editorial.
</div>
</div>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copiado");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copiado");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/aprender-uib\.github\.io\/AD");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./t5_clustering.html" class="pagination-link" aria-label="Agrupamiento (Clustering)">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Agrupamiento (Clustering)</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./referencias.html" class="pagination-link" aria-label="Referencias">
        <span class="nav-page-text">Referencias</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Análisis de Datos UIB</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/AprendeR-UIB/AD/edit/main/t6_series_temporales.qmd" class="toc-action"><i class="bi bi-github"></i>Editar esta página</a></li><li><a href="https://github.com/AprendeR-UIB/AD/issues/new" class="toc-action"><i class="bi empty"></i>Informar de un problema</a></li></ul></div></div>
    <div class="nav-footer-right">
<p>Este libro se ha creado con <a href="https://quarto.org/">Quarto</a>.</p>
</div>
  </div>
</footer>
<script>var lightboxQuarto = GLightbox({"descPosition":"bottom","selector":".lightbox","openEffect":"zoom","closeEffect":"zoom","loop":false});
window.onload = () => {
  lightboxQuarto.on('slide_before_load', (data) => {
    const { slideIndex, slideNode, slideConfig, player, trigger } = data;
    const href = trigger.getAttribute('href');
    if (href !== null) {
      const imgEl = window.document.querySelector(`a[href="${href}"] img`);
      if (imgEl !== null) {
        const srcAttr = imgEl.getAttribute("src");
        if (srcAttr && srcAttr.startsWith("data:")) {
          slideConfig.href = srcAttr;
        }
      }
    } 
  });

  lightboxQuarto.on('slide_after_load', (data) => {
    const { slideIndex, slideNode, slideConfig, player, trigger } = data;
    if (window.Quarto?.typesetMath) {
      window.Quarto.typesetMath(slideNode);
    }
  });

};
          </script>




</body></html>